import e,{webcrypto as t,randomUUID as r}from"crypto";import n from"stream";import i from"zlib";import s from"fs";import o from"path";import a from"os";import f from"net";import h from"tls";import c from"events";import u from"https";import l from"http";import p from"url";const d=new TextEncoder;function g(){const e=new Date;return` ${e.getHours()}h ${e.getMinutes()}m :${e.getSeconds()}s `}function y(e){if(!e)return 0;let t=0;return t="string"==typeof e?d.encode(e).length:"number"==typeof e?1:e.byteLength?e.byteLength:(new TextEncoder).encode(e).length,t}function _(e){var t={exports:{}};return e(t,t.exports),t.exports}function m(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}new TextDecoder;for(var b=function(e){var t=x(e),r=t[0],n=t[1];return 3*(r+n)/4-n},w=function(e){var t,r,n=x(e),i=n[0],s=n[1],o=new S(function(e,t,r){return 3*(t+r)/4-r}(0,i,s)),a=0,f=s>0?i-4:i;for(r=0;r<f;r+=4)t=B[e.charCodeAt(r)]<<18|B[e.charCodeAt(r+1)]<<12|B[e.charCodeAt(r+2)]<<6|B[e.charCodeAt(r+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;2===s&&(t=B[e.charCodeAt(r)]<<2|B[e.charCodeAt(r+1)]>>4,o[a++]=255&t);1===s&&(t=B[e.charCodeAt(r)]<<10|B[e.charCodeAt(r+1)]<<4|B[e.charCodeAt(r+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t);return o},E=function(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(U(e,o,o+s>a?a:o+s));1===n?(t=e[r-1],i.push(v[t>>2]+v[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(v[t>>10]+v[t>>4&63]+v[t<<2&63]+"="));return i.join("")},v=[],B=[],S="undefined"!=typeof Uint8Array?Uint8Array:Array,A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=0,I=A.length;L<I;++L)v[L]=A[L],B[A.charCodeAt(L)]=L;function x(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function U(e,t,r){for(var n,i,s=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(v[(i=n)>>18&63]+v[i>>12&63]+v[i>>6&63]+v[63&i]);return s.join("")}B["-".charCodeAt(0)]=62,B["_".charCodeAt(0)]=63;var T={byteLength:b,toByteArray:w,fromByteArray:E},k=function(e,t,r,n,i){var s,o,a=8*i-n-1,f=(1<<a)-1,h=f>>1,c=-7,u=r?i-1:0,l=r?-1:1,p=e[t+u];for(u+=l,s=p&(1<<-c)-1,p>>=-c,c+=a;c>0;s=256*s+e[t+u],u+=l,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+e[t+u],u+=l,c-=8);if(0===s)s=1-h;else{if(s===f)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)},C=function(e,t,r,n,i,s){var o,a,f,h=8*s-i-1,c=(1<<h)-1,u=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,d=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-o))<1&&(o--,f*=2),(t+=o+u>=1?l/f:l*Math.pow(2,1-u))*f>=2&&(o++,f/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*f-1)*Math.pow(2,i),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[r+p]=255&o,p+=d,o/=256,h-=8);e[r+p-d]|=128*g},O=_((function(e,t){const r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=function(e){+e!=e&&(e=0);return s.alloc(+e)},t.INSPECT_MAX_BYTES=50;const n=2147483647;function i(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return o(e,t,r)}function o(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|l(e,t);let n=i(r);const o=n.write(e,t);o!==r&&(n=n.slice(0,o));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(K(e,Uint8Array)){const t=new Uint8Array(e);return c(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(K(e,ArrayBuffer)||e&&K(e.buffer,ArrayBuffer))return c(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(K(e,SharedArrayBuffer)||e&&K(e.buffer,SharedArrayBuffer)))return c(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,r);const o=function(e){if(s.isBuffer(e)){const t=0|u(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||J(e.length)?i(0):h(e);if("Buffer"===e.type&&Array.isArray(e.data))return h(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return a(e),i(e<0?0:0|u(e))}function h(e){const t=e.length<0?0:0|u(e.length),r=i(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,s.prototype),n}function u(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function l(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||K(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return q(e).length;default:if(i)return n?-1:G(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return B(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function d(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),J(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){let s,o=1,a=e.length,f=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,f/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(h(e,s)===h(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===f)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+f>a&&(r=a-f),s=r;s>=0;s--){let r=!0;for(let n=0;n<f;n++)if(h(e,s+n)!==h(t,n)){r=!1;break}if(r)return s}return-1}function _(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(J(n))return o;e[r+o]=n}return o}function m(e,t,r,n){return Y(G(t,e.length-r),e,r,n)}function b(e,t,r,n){return Y(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return Y(q(t),e,r,n)}function E(e,t,r,n){return Y(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function v(e,t,r){return 0===t&&r===e.length?T.fromByteArray(e):T.fromByteArray(e.slice(t,r))}function B(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,f;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(f=(31&t)<<6|63&r,f>127&&(s=f));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(f=(15&t)<<12|(63&r)<<6|63&n,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(f=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,f>65535&&f<1114112&&(s=f))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,r){return o(e,t,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,r){return function(e,t,r){return a(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},s.allocUnsafe=function(e){return f(e)},s.allocUnsafeSlow=function(e){return f(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(K(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),K(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=s.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(K(t,Uint8Array))i+t.length>n.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!s.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},s.byteLength=l,s.prototype._isBuffer=!0,s.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)d(this,t,t+1);return this},s.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},s.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},s.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?B(this,0,e):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,r,n,i){if(K(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0);const f=Math.min(o,a),h=this.slice(n,i),c=e.slice(t,r);for(let e=0;e<f;++e)if(h[e]!==c[e]){o=h[e],a=c[e];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return m(this,e,t,r);case"ascii":case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const S=4096;function A(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function L(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function I(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=X[e[n]];return i}function x(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function U(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function N(e,t,r,n,i){j(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function R(e,t,r,n,i){j(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function M(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function P(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,4),C(e,t,r,n,23,4),r+4}function D(e,t,r,n,i){return t=+t,r>>>=0,i||M(e,0,r,8),C(e,t,r,n,52,8),r+8}s.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readBigUInt64LE=Z((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),s.prototype.readBigUInt64BE=Z((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},s.prototype.readInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||U(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||U(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readBigInt64LE=Z((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),s.prototype.readBigInt64BE=Z((function(e){W(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||z(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),s.prototype.readFloatLE=function(e,t){return e>>>=0,t||U(e,4,this.length),k(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||U(e,4,this.length),k(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||U(e,8,this.length),k(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||U(e,8,this.length),k(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){O(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){O(this,e,t,r,Math.pow(2,8*r)-1,0)}let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigUInt64LE=Z((function(e,t=0){return N(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeBigUInt64BE=Z((function(e,t=0){return R(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);O(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigInt64LE=Z((function(e,t=0){return N(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeBigInt64BE=Z((function(e,t=0){return R(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeFloatLE=function(e,t,r){return P(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return P(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return D(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return D(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},s.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const o=s.isBuffer(e)?e:s.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};const $={};function H(e,t,r){$[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function F(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function j(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new $.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){W(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||z(t,e.length-(r+1))}(n,i,s)}function W(e,t){if("number"!=typeof e)throw new $.ERR_INVALID_ARG_TYPE(t,"number",e)}function z(e,t,r){if(Math.floor(e)!==e)throw W(e,r),new $.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new $.ERR_BUFFER_OUT_OF_BOUNDS;throw new $.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}H("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),H("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),H("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=F(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=F(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function G(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function q(e){return T.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Y(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function K(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function J(e){return e!=e}const X=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function Z(e){return"undefined"==typeof BigInt?Q:e}function Q(){throw new Error("BigInt not supported")}}));
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */const N=new TextEncoder,R=new TextDecoder,M=P;function P(e,t=0){let r;if(void 0===e||"string"!=typeof e||"number"!=typeof t)throw TypeError("invlaid init variablie type name. ");return(e=e.toUpperCase()).includes("8")?(r=O.Buffer.alloc(1),e.includes("I")?r.writeInt8(t):r.writeUint8(t)):e.includes("16")?(r=O.Buffer.alloc(2),e.includes("I")?e.includes("L")?r.writeInt16LE(t):r.writeInt16BE(t):e.includes("L")?r.writeUint16LE(t):r.writeUint16BE(t)):e.includes("32")?(r=O.Buffer.alloc(4),e.includes("I")?e.includes("L")?r.writeInt32LE(t):r.writeInt32BE(t):e.includes("L")?r.writeUint32LE(t):r.writeUint32BE(t)):e.includes("F")?(r=O.Buffer.alloc(4),e.includes("L")?r.writeFloatLE(t):r.writeFloatBE(t)):e.includes("N")?r=O.Buffer.from(String(t)):console.log(`invalid type: ${e} or initvalue: ${t}`),r}const D=function(e,t,r){let n,i="B";if("number"==typeof t)"number"==typeof r?(n=O.Buffer.alloc(t),0!==r&&n.fill(r),i="B"):(n=O.Buffer.from(String(t)),i="N");else if("string"==typeof t&&"number"==typeof r)i=t.toUpperCase(),n=P(t,r);else if("string"==typeof t&&void 0===r)n=O.Buffer.from(t),i="S";else if(t instanceof Uint8Array&&void 0===r)n=t instanceof O.Buffer?t:O.Buffer.from(t);else if(t instanceof ArrayBuffer&&void 0===r)n=O.Buffer.from(t);else if(ArrayBuffer.isView(t))n=O.Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if("object"==typeof t&&void 0===r)n=O.Buffer.from(JSON.stringify(t)),i="O";else{if("boolean"!=typeof t||void 0!==r)throw TypeError("invalid meta buffer type");{const e=t?1:0;n=O.Buffer.from([e]),i="!"}}"string"==typeof e&&e.includes("#")&&(e="");return[e,i,n]};const $=function(...e){let t=0;const r=e.map((e=>{const r=t++;return"number"==typeof e?D(r,"N",e):D(r,e)}));return r.push(D("$","8",r.length)),r};function H(e){if((e=e.toUpperCase()).includes("8"))return e.includes("I")?"int8":"uint8";if(e.includes("16"))return e.includes("I")?e.includes("L")?"int16_le":"int16_be":e.includes("L")?"uint16_le":"uint16_be";if(e.includes("32"))return e.includes("I")?e.includes("L")?"int32_le":"int32_be":e.includes("L")?"uint32_le":"uint32_be";if(e.includes("F"))return e.includes("L")?"float_le":"float_be";if("B"===e)return"buffer";if("S"===e)return"string";if("N"===e)return"number";if("O"===e)return"object";if("!"===e)return"boolean";throw TypeError("invalid data type")}function F(e,t,r,n){const i=H(e);if("int8"==i)return t.readInt8(r);if("uint8"===i)return t.readUint8(r);if("int16_le"===i)return t.readInt16LE(r);if("int16_be"===i)return t.readInt16BE(r);if("uint16_le"===i)return t.readUint16LE(r);if("uint16_be"===i)return t.readUint16BE(r);if("int32_le"===i)return t.readInt32LE(r);if("int32_be"===i)return t.readInt32BE(r);if("uint32_le"===i)return t.readUint32LE(r);if("uint32_be"===i)return t.readUint32BE(r);if("float_le"===i)return t.readFloatLE(r);if("float_be"===i)return t.readFloatBE(r);if("buffer"===i)return t.subarray(r,r+n);if("string"===i){const e=t.subarray(r,r+n);return R.decode(e)}if("number"===i){const e=t.subarray(r,r+n);return Number(R.decode(e))}if("object"!==i){if("boolean"===i){return 1===t.readInt8(r)}throw TypeError("invalid data")}{const e=t.subarray(r,r+n);try{return JSON.parse(R.decode(e))}catch(e){console.log("err. obj parse")}}}function j(...e){const t=function(e){let t=[];return e.filter((e=>{if(!Array.isArray(e[0]))return e;t=t.concat(e)})).concat(t)}(e);let r=0;const n=[];let i,s,o=0;t.forEach((e=>{const[t,i,s]=e;r+=s.byteLength,("number"==typeof t||t.length>0)&&n.push([t,i,o,s.byteLength]),o=r})),n.length>0&&(i=N.encode(JSON.stringify(n)),s=i.byteLength,r=r+s+2);const a=O.Buffer.alloc(r);if(o=0,t.forEach((e=>{const t=e[2];a.set(t,o),o+=t.byteLength})),n.length>0){a.set(i,o);const e=M("16",s);return a.set(e,o+s),a}return a}function W(e,t){const r=t||function(e,t=!1){e instanceof ArrayBuffer&&(e=O.Buffer.from(e));const r=function(e){e instanceof ArrayBuffer&&(e=O.Buffer.from(e));if(e instanceof Uint8Array){if(e.byteLength<=2)return 0;return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(e.byteLength-2)}return 0}(e);if(0===r)return;let n=function(e,t){try{const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=r.byteLength-t-2,i=r.subarray(n,r.byteLength-2),s=R.decode(i),o=JSON.parse(s);if(!Array.isArray(o)||!Array.isArray(o[0]))return;let a=o[0];if(!a)return;if(a.length<3)return;const[f,h,c]=a;if("string"!=typeof h||"number"!=typeof c)return;return o}catch(e){}}(e,r);if(!n)return;return t?(n.forEach((e=>{null==e[3]&&(e[1].includes("8")?e[3]=1:e[1].includes("16")?e[3]=2:e[1].includes("32")||e[1].includes("F")?e[3]=4:e[1].includes("!")&&(e[3]=1)),e[4]=H(e[1])})),n):n}(e);if(!r)return;const n=O.Buffer.from(e),i={};let s=0;if(r.forEach((e=>{const[t,r,o,a]=e;i[t]=F(r,n,o,a),a&&(s+=a)})),t&&n.byteLength!==s){let e=n.byteLength-s;i.$OTHERS=F("b",n,s,e)}if(i.$){const e=i.$,t=[];for(let r=0;r<e;r++)t.push(i[r]);i.args=t,i.$=i.args}return i}const z=V;function V(e,t=!1){if(void 0===e)throw TypeError("Invalid data type: Undefined");if("string"==typeof e)return N.encode(e);if("number"==typeof e)return Uint8Array.from([e]);if(e instanceof ArrayBuffer){if(t)return new Uint8Array(e);{const t=new Uint8Array(e),r=new Uint8Array(e.byteLength);return r.set(t),r}}if(ArrayBuffer.isView(e)){if(t)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);{const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=new Uint8Array(e.byteLength);return r.set(t),r}}return N.encode(JSON.stringify(e))}const G=function(...e){try{let t=0,r=0;const n=e.map((e=>V(e)));n.forEach((e=>{t+=e.byteLength}));const i=new Uint8Array(t);return n.forEach((e=>{i.set(e,r),r+=e.byteLength})),i}catch(e){console.log(e)}};var q=_((function(e,t){e.exports=function(){function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){if(!a&&m)return m(o);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var h=r[o]={exports:{}};t[o][0].call(h.exports,(function(e){return i(t[o][1][e]||e)}),h,h.exports,e,t,r,n)}return r[o].exports}for(var s=m,o=0;o<n.length;o++)i(n[o]);return i}return e}()({1:[function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function s(){}function o(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,n,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new o(r,n||e,s),f=i?i+t:t;return e._events[f]?e._events[f].fn?e._events[f]=[e._events[f],a]:e._events[f].push(a):(e._events[f]=a,e._eventsCount++),e}function f(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function h(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),h.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},h.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,s=r.length,o=new Array(s);n<s;n++)o[n]=r[n].fn;return o},h.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},h.prototype.emit=function(e,t,r,n,s,o){var a=i?i+e:e;if(!this._events[a])return!1;var f,h,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,n),!0;case 5:return c.fn.call(c.context,t,r,n,s),!0;case 6:return c.fn.call(c.context,t,r,n,s,o),!0}for(h=1,f=new Array(u-1);h<u;h++)f[h-1]=arguments[h];c.fn.apply(c.context,f)}else{var l,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(e,c[h].fn,void 0,!0),u){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,t);break;case 3:c[h].fn.call(c[h].context,t,r);break;case 4:c[h].fn.call(c[h].context,t,r,n);break;default:if(!f)for(l=1,f=new Array(u-1);l<u;l++)f[l-1]=arguments[l];c[h].fn.apply(c[h].context,f)}}return!0},h.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},h.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},h.prototype.removeListener=function(e,t,r,n){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return f(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||n&&!o.once||r&&o.context!==r||f(this,s);else{for(var a=0,h=[],c=o.length;a<c;a++)(o[a].fn!==t||n&&!o[a].once||r&&o[a].context!==r)&&h.push(o[a]);h.length?this._events[s]=1===h.length?h[0]:h:f(this,s)}return this},h.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&f(this,t)):(this._events=new s,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=i,h.EventEmitter=h,void 0!==t&&(t.exports=h)},{}]},{},[1])(1)}));const Y=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function K(e,t,r,n,i){let s,o,a,f,h,c,u,l,p,d,g,y,_;for(;i>=64;){for(s=t[0],o=t[1],a=t[2],f=t[3],h=t[4],c=t[5],u=t[6],l=t[7],d=0;d<16;d++)g=n+4*d,e[d]=(255&r[g])<<24|(255&r[g+1])<<16|(255&r[g+2])<<8|255&r[g+3];for(d=16;d<64;d++)p=e[d-2],y=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,p=e[d-15],_=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,e[d]=(y+e[d-7]|0)+(_+e[d-16]|0);for(d=0;d<64;d++)y=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&c^~h&u)|0)+(l+(Y[d]+e[d]|0)|0)|0,_=((s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+(s&o^s&a^o&a)|0,l=u,u=c,c=h,h=f+y|0,f=a,a=o,o=s,s=y+_|0;t[0]+=s,t[1]+=o,t[2]+=a,t[3]+=f,t[4]+=h,t[5]+=c,t[6]+=u,t[7]+=l,n+=64,i-=64}return n}const J=function(){function e(){this.digestLength=32,this.blockSize=64,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return e.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},e.prototype.clean=function(){for(var e=0;e<this.buffer.length;e++)this.buffer[e]=0;for(e=0;e<this.temp.length;e++)this.temp[e]=0;this.reset()},e.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");let r=0;if(this.bytesHashed+=t,this.bufferLength>0){for(;this.bufferLength<64&&t>0;)this.buffer[this.bufferLength++]=e[r++],t--;64===this.bufferLength&&(K(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(t>=64&&(r=K(this.temp,this.state,e,r,t),t%=64);t>0;)this.buffer[this.bufferLength++]=e[r++],t--;return this},e.prototype.finish=function(e){if(!this.finished){const e=this.bytesHashed,r=this.bufferLength,n=e/536870912|0,i=e<<3,s=e%64<56?64:128;this.buffer[r]=128;for(var t=r+1;t<s-8;t++)this.buffer[t]=0;this.buffer[s-8]=n>>>24&255,this.buffer[s-7]=n>>>16&255,this.buffer[s-6]=n>>>8&255,this.buffer[s-5]=n>>>0&255,this.buffer[s-4]=i>>>24&255,this.buffer[s-3]=i>>>16&255,this.buffer[s-2]=i>>>8&255,this.buffer[s-1]=i>>>0&255,K(this.temp,this.state,this.buffer,0,s),this.finished=!0}for(t=0;t<8;t++)e[4*t+0]=this.state[t]>>>24&255,e[4*t+1]=this.state[t]>>>16&255,e[4*t+2]=this.state[t]>>>8&255,e[4*t+3]=this.state[t]>>>0&255;return this},e.prototype.digest=function(){const e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype._saveState=function(e){for(let t=0;t<this.state.length;t++)e[t]=this.state[t]},e.prototype._restoreState=function(e,t){for(let t=0;t<this.state.length;t++)this.state[t]=e[t];this.bytesHashed=t,this.finished=!1,this.bufferLength=0},e}(),X=function(){function e(e){this.inner=new J,this.outer=new J,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;const t=new Uint8Array(this.blockSize);if(e.length>this.blockSize)(new J).update(e).finish(t).clean();else for(var r=0;r<e.length;r++)t[r]=e[r];for(r=0;r<t.length;r++)t[r]^=54;for(this.inner.update(t),r=0;r<t.length;r++)t[r]^=106;for(this.outer.update(t),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate),r=0;r<t.length;r++)t[r]=0}return e.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},e.prototype.clean=function(){for(let e=0;e<this.istate.length;e++)this.ostate[e]=this.istate[e]=0;this.inner.clean(),this.outer.clean()},e.prototype.update=function(e){return this.inner.update(e),this},e.prototype.finish=function(e){return this.outer.finished?this.outer.finish(e):(this.inner.finish(e),this.outer.update(e,this.digestLength).finish(e)),this},e.prototype.digest=function(){const e=new Uint8Array(this.digestLength);return this.finish(e),e},e}();function Z(e){const t=(new J).update(e),r=t.digest();return t.clean(),r}for(var Q=[],ee=[],te="undefined"!=typeof Uint8Array?Uint8Array:Array,re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ne=0,ie=re.length;ne<ie;++ne)Q[ne]=re[ne],ee[re.charCodeAt(ne)]=ne;function se(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function oe(e,t,r){for(var n,i,s=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(Q[(i=n)>>18&63]+Q[i>>12&63]+Q[i>>6&63]+Q[63&i]);return s.join("")}ee["-".charCodeAt(0)]=62,ee["_".charCodeAt(0)]=63;var ae,fe,he=function(e){var t,r,n=se(e),i=n[0],s=n[1],o=new te(function(e,t,r){return 3*(t+r)/4-r}(0,i,s)),a=0,f=s>0?i-4:i;for(r=0;r<f;r+=4)t=ee[e.charCodeAt(r)]<<18|ee[e.charCodeAt(r+1)]<<12|ee[e.charCodeAt(r+2)]<<6|ee[e.charCodeAt(r+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=255&t;return 2===s&&(t=ee[e.charCodeAt(r)]<<2|ee[e.charCodeAt(r+1)]>>4,o[a++]=255&t),1===s&&(t=ee[e.charCodeAt(r)]<<10|ee[e.charCodeAt(r+1)]<<4|ee[e.charCodeAt(r+2)]>>2,o[a++]=t>>8&255,o[a++]=255&t),o},ce=function(e){for(var t,r=e.length,n=r%3,i=[],s=16383,o=0,a=r-n;o<a;o+=s)i.push(oe(e,o,o+s>a?a:o+s));return 1===n?(t=e[r-1],i.push(Q[t>>2]+Q[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(Q[t>>10]+Q[t>>4&63]+Q[t<<2&63]+"=")),i.join("")},ue=function(e,t,r,n,i){var s,o,a=8*i-n-1,f=(1<<a)-1,h=f>>1,c=-7,u=r?i-1:0,l=r?-1:1,p=e[t+u];for(u+=l,s=p&(1<<-c)-1,p>>=-c,c+=a;c>0;s=256*s+e[t+u],u+=l,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+e[t+u],u+=l,c-=8);if(0===s)s=1-h;else{if(s===f)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)},le=function(e,t,r,n,i,s){var o,a,f,h=8*s-i-1,c=(1<<h)-1,u=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:s-1,d=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-o))<1&&(o--,f*=2),(t+=o+u>=1?l/f:l*Math.pow(2,1-u))*f>=2&&(o++,f/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(t*f-1)*Math.pow(2,i),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,i),o=0));i>=8;e[r+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;e[r+p]=255&o,p+=d,o/=256,h-=8);e[r+p-d]|=128*g},pe=(ae=function(e,t){const r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=function(e){return+e!=e&&(e=0),s.alloc(+e)},t.INSPECT_MAX_BYTES=50;const n=2147483647;function i(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return o(e,t,r)}function o(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const r=0|l(e,t);let n=i(r);const o=n.write(e,t);return o!==r&&(n=n.slice(0,o)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){const t=new Uint8Array(e);return c(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return c(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return c(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return s.from(n,t,r);const o=function(e){if(s.isBuffer(e)){const t=0|u(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||q(e.length)?i(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function f(e){return a(e),i(e<0?0:0|u(e))}function h(e){const t=e.length<0?0:0|u(e.length),r=i(t);for(let n=0;n<t;n+=1)r[n]=255&e[n];return r}function c(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,s.prototype),n}function u(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function l(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return z(e).length;default:if(i)return n?-1:W(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){let n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return B(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function d(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),q(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=s.from(t,n)),s.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){let s,o=1,a=e.length,f=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,a/=2,f/=2,r/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){let n=-1;for(s=r;s<a;s++)if(h(e,s)===h(t,-1===n?0:s-n)){if(-1===n&&(n=s),s-n+1===f)return n*o}else-1!==n&&(s-=s-n),n=-1}else for(r+f>a&&(r=a-f),s=r;s>=0;s--){let r=!0;for(let n=0;n<f;n++)if(h(e,s+n)!==h(t,n)){r=!1;break}if(r)return s}return-1}function _(e,t,r,n){r=Number(r)||0;const i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;const s=t.length;let o;for(n>s/2&&(n=s/2),o=0;o<n;++o){const n=parseInt(t.substr(2*o,2),16);if(q(n))return o;e[r+o]=n}return o}function m(e,t,r,n){return V(W(t,e.length-r),e,r,n)}function b(e,t,r,n){return V(function(e){const t=[];for(let r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function w(e,t,r,n){return V(z(t),e,r,n)}function E(e,t,r,n){return V(function(e,t){let r,n,i;const s=[];for(let o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,s.push(i),s.push(n);return s}(t,e.length-r),e,r,n)}function v(e,t,r){return 0===t&&r===e.length?ce(e):ce(e.slice(t,r))}function B(e,t,r){r=Math.min(e.length,r);const n=[];let i=t;for(;i<r;){const t=e[i];let s=null,o=t>239?4:t>223?3:t>191?2:1;if(i+o<=r){let r,n,a,f;switch(o){case 1:t<128&&(s=t);break;case 2:r=e[i+1],128==(192&r)&&(f=(31&t)<<6|63&r,f>127&&(s=f));break;case 3:r=e[i+1],n=e[i+2],128==(192&r)&&128==(192&n)&&(f=(15&t)<<12|(63&r)<<6|63&n,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:r=e[i+1],n=e[i+2],a=e[i+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(f=(15&t)<<18|(63&r)<<12|(63&n)<<6|63&a,f>65535&&f<1114112&&(s=f))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),i+=o}return function(e){const t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}t.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,r){return o(e,t,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,r){return function(e,t,r){return a(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},s.allocUnsafe=function(e){return f(e)},s.allocUnsafeSlow=function(e){return f(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let r=e.length,n=t.length;for(let i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);let r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;const n=s.allocUnsafe(t);let i=0;for(r=0;r<e.length;++r){let t=e[r];if(G(t,Uint8Array))i+t.length>n.length?(s.isBuffer(t)||(t=s.from(t)),t.copy(n,i)):Uint8Array.prototype.set.call(n,t,i);else{if(!s.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(n,i)}i+=t.length}return n},s.byteLength=l,s.prototype._isBuffer=!0,s.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)d(this,t,t+1);return this},s.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)d(this,t,t+3),d(this,t+1,t+2);return this},s.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)d(this,t,t+7),d(this,t+1,t+6),d(this,t+2,t+5),d(this,t+3,t+4);return this},s.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?B(this,0,e):p.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){let e="";const r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(e,t,r,n,i){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;let o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0);const f=Math.min(o,a),h=this.slice(n,i),c=e.slice(t,r);for(let e=0;e<f;++e)if(h[e]!==c[e]){o=h[e],a=c[e];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},s.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},s.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},s.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let s=!1;for(;;)switch(n){case"hex":return _(this,e,t,r);case"utf8":case"utf-8":return m(this,e,t,r);case"ascii":case"latin1":case"binary":return b(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const S=4096;function A(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function L(e,t,r){let n="";r=Math.min(e.length,r);for(let i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function I(e,t,r){const n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=t;n<r;++n)i+=Y[e[n]];return i}function x(e,t,r){const n=e.slice(t,r);let i="";for(let e=0;e<n.length-1;e+=2)i+=String.fromCharCode(n[e]+256*n[e+1]);return i}function U(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function T(e,t,r,n,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function k(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s,s>>=8,e[r++]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,o>>=8,e[r++]=o,r}function C(e,t,r,n,i){$(t,n,i,e,r,7);let s=Number(t&BigInt(4294967295));e[r+7]=s,s>>=8,e[r+6]=s,s>>=8,e[r+5]=s,s>>=8,e[r+4]=s;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[r+3]=o,o>>=8,e[r+2]=o,o>>=8,e[r+1]=o,o>>=8,e[r]=o,r+8}function O(e,t,r,n,i,s){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function N(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,4),le(e,t,r,n,23,4),r+4}function R(e,t,r,n,i){return t=+t,r>>>=0,i||O(e,0,r,8),le(e,t,r,n,52,8),r+8}s.prototype.slice=function(e,t){const r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);const n=this.subarray(e,t);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e+--t],i=1;for(;t>0&&(i*=256);)n+=this[e+--t]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||U(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readBigUInt64LE=K((function(e){H(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))})),s.prototype.readBigUInt64BE=K((function(e){H(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)})),s.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=this[e],i=1,s=0;for(;++s<t&&(i*=256);)n+=this[e+s]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*t)),n},s.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||U(e,t,this.length);let n=t,i=1,s=this[e+--n];for(;n>0&&(i*=256);)s+=this[e+--n]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s},s.prototype.readInt8=function(e,t){return e>>>=0,t||U(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||U(e,2,this.length);const r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(e,t){e>>>=0,t||U(e,2,this.length);const r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readBigInt64LE=K((function(e){H(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=this[e+4]+256*this[e+5]+65536*this[e+6]+(r<<24);return(BigInt(n)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),s.prototype.readBigInt64BE=K((function(e){H(e>>>=0,"offset");const t=this[e],r=this[e+7];void 0!==t&&void 0!==r||F(e,this.length-8);const n=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(n)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+r)})),s.prototype.readFloatLE=function(e,t){return e>>>=0,t||U(e,4,this.length),ue(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||U(e,4,this.length),ue(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||U(e,8,this.length),ue(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||U(e,8,this.length),ue(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);let i=1,s=0;for(this[t]=255&e;++s<r&&(i*=256);)this[t+s]=e/i&255;return t+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||T(this,e,t,r,Math.pow(2,8*r)-1,0);let i=r-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigUInt64LE=K((function(e,t=0){return k(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeBigUInt64BE=K((function(e,t=0){return C(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);T(this,e,t,r,n-1,-n)}let i=0,s=1,o=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},s.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){const n=Math.pow(2,8*r-1);T(this,e,t,r,n-1,-n)}let i=r-1,s=1,o=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/s>>0)-o&255;return t+r},s.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeBigInt64LE=K((function(e,t=0){return k(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeBigInt64BE=K((function(e,t=0){return C(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeFloatLE=function(e,t,r){return N(this,e,t,!0,r)},s.prototype.writeFloatBE=function(e,t,r){return N(this,e,t,!1,r)},s.prototype.writeDoubleLE=function(e,t,r){return R(this,e,t,!0,r)},s.prototype.writeDoubleBE=function(e,t,r){return R(this,e,t,!1,r)},s.prototype.copy=function(e,t,r,n){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);const i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},s.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){const t=e.charCodeAt(0);("utf8"===n&&t<128||"latin1"===n)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;let i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{const o=s.isBuffer(e)?e:s.from(e,n),a=o.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=o[i%a]}return this};const M={};function P(e,t,r){M[e]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function D(e){let t="",r=e.length;const n="-"===e[0]?1:0;for(;r>=n+4;r-=3)t=`_${e.slice(r-3,r)}${t}`;return`${e.slice(0,r)}${t}`}function $(e,t,r,n,i,s){if(e>r||e<t){const n="bigint"==typeof t?"n":"";let i;throw i=s>3?0===t||t===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`:`>= ${t}${n} and <= ${r}${n}`,new M.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,r){H(t,"offset"),void 0!==e[t]&&void 0!==e[t+r]||F(t,e.length-(r+1))}(n,i,s)}function H(e,t){if("number"!=typeof e)throw new M.ERR_INVALID_ARG_TYPE(t,"number",e)}function F(e,t,r){if(Math.floor(e)!==e)throw H(e,r),new M.ERR_OUT_OF_RANGE(r||"offset","an integer",e);if(t<0)throw new M.ERR_BUFFER_OUT_OF_BOUNDS;throw new M.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${t}`,e)}P("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),P("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),P("ERR_OUT_OF_RANGE",(function(e,t,r){let n=`The value of "${e}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=D(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=D(i)),i+="n"),n+=` It must be ${t}. Received ${i}`,n}),RangeError);const j=/[^+/0-9A-Za-z-_]/g;function W(e,t){let r;t=t||1/0;const n=e.length;let i=null;const s=[];for(let o=0;o<n;++o){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function z(e){return he(function(e){if((e=(e=e.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,r,n){let i;for(i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function q(e){return e!=e}const Y=function(){const e="0123456789abcdef",t=new Array(256);for(let r=0;r<16;++r){const n=16*r;for(let i=0;i<16;++i)t[n+i]=e[r]+e[i]}return t}();function K(e){return"undefined"==typeof BigInt?J:e}function J(){throw new Error("BigInt not supported")}},ae(fe={exports:{}},fe.exports),fe.exports);
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */const de=new TextEncoder,ge=new TextDecoder,ye=_e;function _e(e,t=0){let r;if(void 0===e||"string"!=typeof e||"number"!=typeof t)throw TypeError("invlaid init variablie type name. ");return(e=e.toUpperCase()).includes("8")?(r=pe.Buffer.alloc(1),e.includes("I")?r.writeInt8(t):r.writeUint8(t)):e.includes("16")?(r=pe.Buffer.alloc(2),e.includes("I")?e.includes("L")?r.writeInt16LE(t):r.writeInt16BE(t):e.includes("L")?r.writeUint16LE(t):r.writeUint16BE(t)):e.includes("32")?(r=pe.Buffer.alloc(4),e.includes("I")?e.includes("L")?r.writeInt32LE(t):r.writeInt32BE(t):e.includes("L")?r.writeUint32LE(t):r.writeUint32BE(t)):e.includes("F")?(r=pe.Buffer.alloc(4),e.includes("L")?r.writeFloatLE(t):r.writeFloatBE(t)):e.includes("N")?r=pe.Buffer.from(String(t)):console.log(`invalid type: ${e} or initvalue: ${t}`),r}const me=be;function be(e,t,r){let n,i="B";if("number"==typeof t)"number"==typeof r?(n=pe.Buffer.alloc(t),0!==r&&n.fill(r),i="B"):(n=pe.Buffer.from(String(t)),i="N");else if("string"==typeof t&&"number"==typeof r)i=t.toUpperCase(),n=_e(t,r);else if("string"==typeof t&&void 0===r)n=pe.Buffer.from(t),i="S";else if(t instanceof Uint8Array&&void 0===r)n=t instanceof pe.Buffer?t:pe.Buffer.from(t);else if(t instanceof ArrayBuffer&&void 0===r)n=pe.Buffer.from(t);else if(ArrayBuffer.isView(t))n=pe.Buffer.from(t.buffer,t.byteOffset,t.byteLength);else if("object"==typeof t&&void 0===r)n=pe.Buffer.from(JSON.stringify(t)),i="O";else{if("boolean"!=typeof t||void 0!==r)throw TypeError("invalid meta buffer type");{const e=t?1:0;n=pe.Buffer.from([e]),i="!"}}return"string"==typeof e&&e.includes("#")&&(e=""),[e,i,n]}const we=Ee;function Ee(...e){let t=0;const r=e.map((e=>{const r=t++;return"number"==typeof e?me(r,"N",e):me(r,e)}));return r.push(me("$","8",r.length)),r}function ve(e){if((e=e.toUpperCase()).includes("8"))return e.includes("I")?"int8":"uint8";if(e.includes("16"))return e.includes("I")?e.includes("L")?"int16_le":"int16_be":e.includes("L")?"uint16_le":"uint16_be";if(e.includes("32"))return e.includes("I")?e.includes("L")?"int32_le":"int32_be":e.includes("L")?"uint32_le":"uint32_be";if(e.includes("F"))return e.includes("L")?"float_le":"float_be";if("B"===e)return"buffer";if("S"===e)return"string";if("N"===e)return"number";if("O"===e)return"object";if("!"===e)return"boolean";throw TypeError("invalid data type")}function Be(e,t,r,n){const i=ve(e);if("int8"==i)return t.readInt8(r);if("uint8"===i)return t.readUint8(r);if("int16_le"===i)return t.readInt16LE(r);if("int16_be"===i)return t.readInt16BE(r);if("uint16_le"===i)return t.readUint16LE(r);if("uint16_be"===i)return t.readUint16BE(r);if("int32_le"===i)return t.readInt32LE(r);if("int32_be"===i)return t.readInt32BE(r);if("uint32_le"===i)return t.readUint32LE(r);if("uint32_be"===i)return t.readUint32BE(r);if("float_le"===i)return t.readFloatLE(r);if("float_be"===i)return t.readFloatBE(r);if("buffer"===i)return t.subarray(r,r+n);if("string"===i){const e=t.subarray(r,r+n);return ge.decode(e)}if("number"===i){const e=t.subarray(r,r+n);return Number(ge.decode(e))}if("object"!==i){if("boolean"===i)return 1===t.readInt8(r);throw TypeError("invalid data")}{const i=t.subarray(r,r+n);try{return JSON.parse(ge.decode(i))}catch(e){console.log("err. obj parse")}}}function Se(...e){const t=function(e){let t=[];return e.filter((e=>{if(!Array.isArray(e[0]))return e;t=t.concat(e)})).concat(t)}(e);let r=0;const n=[];let i,s,o=0;t.forEach((e=>{const[t,i,s]=e;r+=s.byteLength,("number"==typeof t||t.length>0)&&n.push([t,i,o,s.byteLength]),o=r})),n.length>0&&(i=de.encode(JSON.stringify(n)),s=i.byteLength,r=r+s+2);const a=pe.Buffer.alloc(r);if(o=0,t.forEach((e=>{const t=e[2];a.set(t,o),o+=t.byteLength})),n.length>0){a.set(i,o);const e=ye("16",s);return a.set(e,o+s),a}return a}function Ae(e,t){const r=t||je(e);if(!r)return;const n=pe.Buffer.from(e),i={};let s=0;if(r.forEach((e=>{const[t,r,o,a]=e;i[t]=Be(r,n,o,a),a&&(s+=a)})),t&&n.byteLength!==s){let e=n.byteLength-s;i.$OTHERS=Be("b",n,s,e)}if(i.$){const e=i.$,t=[];for(let r=0;r<e;r++)t.push(i[r]);i.args=t,i.$=i.args}return i}const Le=Ie;function Ie(e,t=!1){if(void 0===e)throw TypeError("Invalid data type: Undefined");if("string"==typeof e)return de.encode(e);if("number"==typeof e)return Uint8Array.from([e]);if(e instanceof ArrayBuffer){if(t)return new Uint8Array(e);{const t=new Uint8Array(e),r=new Uint8Array(e.byteLength);return r.set(t),r}}if(ArrayBuffer.isView(e)){if(t)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);{const t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=new Uint8Array(e.byteLength);return r.set(t),r}}return de.encode(JSON.stringify(e))}const xe=Ue;function Ue(e,t=!1){const r=Ie(e,t);return t?pe.Buffer.from(r.buffer,r.byteOffset,r.byteLength):pe.Buffer.from(r)}const Te=ke;function ke(...e){const t=e.map((e=>Ue(e)));return pe.Buffer.concat(t)}const Ce=Oe;function Oe(...e){try{let t=0,r=0;const n=e.map((e=>Ie(e)));n.forEach((e=>{t+=e.byteLength}));const i=new Uint8Array(t);return n.forEach((e=>{i.set(e,r),r+=e.byteLength})),i}catch(e){console.log(e)}}function Ne(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Re(e,t){if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Me(e){return 0===He(e)?e.byteLength:e.byteLength-He(e)-De}function Pe(e,t){try{const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=r.byteLength-t-2,i=r.subarray(n,r.byteLength-2),s=ge.decode(i),o=JSON.parse(s);if(!Array.isArray(o)||!Array.isArray(o[0]))return;let a=o[0];if(!a)return;if(a.length<3)return;const[f,h,c]=a;if("string"!=typeof h||"number"!=typeof c)return;return o}catch(e){}}const De=2;function $e(e){return e instanceof ArrayBuffer&&(e=pe.Buffer.from(e)),e instanceof Uint8Array?e.byteLength<=De?0:new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(e.byteLength-De):0}function He(e){if(e instanceof ArrayBuffer&&(e=pe.Buffer.from(e)),e instanceof Uint8Array){const t=e.byteLength;if(t<=De)return 0;const r=$e(e);return 0===r||r>t?0:Pe(e,r)?r:0}return 0}function Fe(e){const t=Me(e);return e.subarray(0,t)}function je(e,t=!1){e instanceof ArrayBuffer&&(e=pe.Buffer.from(e));const r=$e(e);if(0===r)return;let n=Pe(e,r);return n?t?(n.forEach((e=>{null==e[3]&&(e[1].includes("8")?e[3]=1:e[1].includes("16")?e[3]=2:e[1].includes("32")||e[1].includes("F")?e[3]=4:e[1].includes("!")&&(e[3]=1)),e[4]=ve(e[1])})),n):n:void 0}function We(...e){return Fe(Se(...e))}function ze(...e){return je(Se(...e))}var Ve=Object.freeze({__proto__:null,Buffer:pe.Buffer,NB:ye,numberBuffer:_e,MB:me,metaBuffer:be,MBA:we,metaBufferArguments:Ee,parseTypeName:ve,readTypedBuffer:Be,pack:Se,unpack:Ae,U8:Le,parseUint8Array:Ie,B8:xe,parseBuffer:Ue,B8pack:Te,parseBufferThenConcat:ke,U8pack:Ce,parseUint8ThenConcat:Oe,hex:Ne,equal:Re,getBufferSize:Me,parseMetaInfo:Pe,TAIL_LEN:De,readTail:$e,getMetaSize:He,getBuffer:Fe,getMeta:je,rawPack:We,meta:ze,metaDetail:function(...e){return je(Se(...e),!0)},getMetaDetail:function(e){return je(e,!0)}});Z.hash=function(e){return Z(Le(e))},Z.hex=function(e){return Ne(Z.hash(e))},Z.hmac=function(e,t){return function(e,t){const r=new X(e).update(t),n=r.digest();return r.clean(),n}(Le(e),Le(t))};const Ge=me;let qe={AUTH_REQ:128,AUTH_HMAC:129,AUTH_TOCKEN:130,AUTH_ACK:131,AUTH_FAIL:132,ADM:133,PING:138,PONG:139,ECHO:140,LOOP:141,IAM:142,IAM_RES:143,SUB_STR_CH:144,SUB_BCH1:145,SUB_BCH2:146,SUB_BCH3:147,SUB_BCH4:148,SUB_STR_CH_RET:160,UNSUB:175,PUB_STR_CH:176,PUB_BIN_CH1:177,PUB_BIN_CH2:178,PUB_BIN_CH3:179,PUB_BIN_CH4:180,PUB_STR_CH_RET:192,RES_MID_CODE_MBP:224,RES_MID_CODE:225,RES_IAM:226,ENC_PACK:240,ENC_0808:241,LAST:255};for(let e in qe)qe[qe[e]]=e;const Ye={AUTH_REQ:ze(Ge("header","8",0),Ge("unixTime","32L",0),Ge("milTime","32L",0),Ge("nonce",pe.Buffer.alloc(4))),AUTH_HMAC:ze(Ge("header","8",0),Ge("hashID8",pe.Buffer.alloc(8)),Ge("hmac8",pe.Buffer.alloc(8)),Ge("nonce",pe.Buffer.alloc(4))),AUTH_ACK:ze(Ge("header","8",0),Ge("hmac8",pe.Buffer.alloc(8))),AUTH_TOCKEN:ze(Ge("header","8",0),Ge("tocken",pe.Buffer.alloc(20))),IAM_RES:ze(Ge("header","8",0)),ENC_0808:ze(Ge("type","8",0),Ge("len","16L",0),Ge("otpSrc8",pe.Buffer.alloc(8)),Ge("hmac8",pe.Buffer.alloc(8))),ENC_PACK:ze(Ge("type","8",0),Ge("len","16L",0),Ge("salt12",pe.Buffer.alloc(12)),Ge("hmac",8,0))};function Ke(e){let t=e[e.length-1];return t[2]+t[3]}const Je={ENC_PACK:Ke(Ye.ENC_PACK),ENC_0808:Ke(Ye.ENC_0808),AUTH_REQ:Ke(Ye.AUTH_REQ),AUTH_HMAC:Ke(Ye.AUTH_HMAC),AUTH_ACK:Ke(Ye.AUTH_ACK)};let Xe;const Ze=new TextEncoder;new TextDecoder;let Qe=!1;try{Qe="[object process]"===Object.prototype.toString.call(global.process)}catch(e){}try{Qe?(console.log("# node.js env:"),Xe=t):"function"==typeof importScripts?(Xe=self.crypto,console.log("# Web Worker env")):"undefined"!=typeof document&&(Xe=window.crypto,console.log("# browser env"))}catch(e){console.log("webCrypto err: ",e)}function et(e){const t=performance.now();let r=new Uint8Array(32);for(let t=0;t<e;t++)r=Z.hash(r);return(1e3*e/(performance.now()-t)).toFixed(0)}const tt=Xe.getRandomValues(new Uint8Array(8));function rt(e){return Xe.getRandomValues(pe.Buffer.alloc(e))}Xe.subtle.digest("SHA-256",tt).then((e=>{if(Ne(e)!==Z.hex(tt))throw new Error("diffrent hash result")}));const nt=et(1e4);const it=me,st=ye;class ot{constructor(e,t){this.hashID8=pe.Buffer.alloc(8),this._otpSrc44=pe.Buffer.alloc(44),this._otp36=pe.Buffer.alloc(36),this._hmac=pe.Buffer.alloc(32),this.auth_salt12=pe.Buffer.alloc(12),this.localNonce=pe.Buffer.alloc(4),this.remoteNonce=pe.Buffer.alloc(4),this.isAuthorized=!1,this.dataMax=64,e&&this.setStrID(e),t&&this.setStrKey(t)}setStrID(e){xe(Z.hash(e)).copy(this.hashID8,0,0,8)}setHashID(e){e.copy(this.hashID8,0,0,8)}setStrKey(e){xe(Z.hash(e)).copy(this._otpSrc44,0,0,32)}setHashKey(e){e.copy(this._otpSrc44,0,0,32)}nTimesHash(e,t){let r=Z.hash(e);for(let e=0;e<t;e++)r=Z.hash(r);return r}set_clock_rand(){let e=Date.now(),t=parseInt(e/1e3);e%=4294967295,pe.Buffer.concat([st("32L",t),st("32L",e),rt(4)]).copy(this._otpSrc44,32)}set_clock_nonce(e){let t=Date.now(),r=parseInt(t/1e3);t%=4294967295,pe.Buffer.concat([st("32L",r),st("32L",t),e]).copy(this._otpSrc44,32)}set_salt12(e){e.copy(this._otpSrc44,32)}resetOTP(){xe(Z.hash(this._otpSrc44)).copy(this._otp36,0,0,32)}getIndexOTP(e){return this._otp36.writeUInt32LE(e,32),Z.hash(this._otp36)}generateHMAC(e){let t=pe.Buffer.concat([this._otpSrc44,e]);this._hmac=xe(Z.hash(t))}getHMAC8(e){let t=pe.Buffer.concat([this._otpSrc44,e]);return this._hmac=xe(Z.hash(t)),this._hmac.subarray(0,8)}xotp(e,t=0,r=!1){let n=(e=xe(e,r)).byteLength,i=t,s=0,o=0;for(;n>0;){o=n<32?n:32;let t=this.getIndexOTP(++i);for(let r=0;r<o;r++)e[s++]^=t[r];n-=32}return e}auth_req(){let e=Date.now(),t=Math.floor(e/1e3),r=e%1e3;return this.localNonce=rt(4),this.auth_salt12=pe.Buffer.concat([st("32L",t),st("32L",r),this.localNonce]),pe.Buffer.concat([st("8",qe.AUTH_REQ),this.auth_salt12])}auth_hmac(e){let t=Ae(e,Ye.AUTH_REQ);if(t){let e=pe.Buffer.concat([st("32L",t.unixTime),st("32L",t.milTime),t.nonce]);this.set_salt12(e),this.localNonce=rt(4),this.generateHMAC(this.localNonce);let r=this._hmac.subarray(0,8);return this.remoteNonce=t.nonce,Se(it("#header","8",qe.AUTH_HMAC),it("#hashID8",this.hashID8),it("#hmac8",r),it("#nonce",this.localNonce))}return!1}check_auth_hmac(e){let t;if(e instanceof Uint8Array){if(t=Ae(e,Ye.AUTH_HMAC),!t)return}else t=e;this.set_salt12(this.auth_salt12),this.generateHMAC(t.nonce);let r=this._hmac.subarray(0,8);if(Re(t.hmac8,r)){this.remoteNonce=t.nonce;let e=pe.Buffer.concat([this.localNonce,this.remoteNonce,this.localNonce]);this.set_salt12(e),this.generateHMAC(t.nonce);let r=this._hmac.subarray(0,8),n=We(it("header","8",qe.AUTH_ACK),it("hmac8",r));return this.isAuthorized=!0,n}return!1}check_auth_ack_hmac(e){let t=Ae(e,Ye.AUTH_ACK);if(t){let e=pe.Buffer.concat([this.remoteNonce,this.localNonce,this.remoteNonce]);if(this.set_salt12(e),this.generateHMAC(this.localNonce),Re(this._hmac.subarray(0,8),t.hmac8))return this.isAuthorized=!0,!0}}encrypt_remote_type_0808(e){if(!this.isAuthorized)return;e=xe(e),this.set_clock_nonce(this.remoteNonce),this.resetOTP();let t=this.getHMAC8(e),r=this.xotp(e);return Se(me("#type","8",qe.ENC_0808),me("#len","16L",e.byteLength),me("#otpSrc8",this._otpSrc44.subarray(32,40)),me("#hmac8",t),me("#xdata",r))}decrypt_remote_type_0808(e){if(!this.isAuthorized)return;let t=Ae(e=xe(e),Ye.ENC_0808);if(t){if(t.len!==e.byteLength-Je.ENC_0808)throw Error("size distmatch");let r=pe.Buffer.concat([t.otpSrc8,this.localNonce]);this.set_salt12(r),this.resetOTP();let n=t.$OTHERS,i=this.xotp(n);if(Re(this.getHMAC8(i),t.hmac8))return i}}encryptPack(e){if((e=xe(e)).byteLength>=65536)throw Error("data size over.");this.set_clock_rand(),this.resetOTP();let t=this.getHMAC8(e),r=this.xotp(e);return Se(me("#type","8",qe.ENC_PACK),me("#len","16L",e.byteLength),me("#salt12",this._otpSrc44.subarray(32)),me("#hmac8",t),me("#xdata",r))}decryptPack(e){if(e[0]!==qe.ENC_PACK)return void console.log("Invalid packType");let t=e.readUint16LE(1);if(t==e.byteLength-Je.ENC_PACK)try{let t=Ae(e,Ye.ENC_PACK);if(!t)return;this.set_salt12(t.salt12),this.resetOTP();let r=t.$OTHERS,n=this.xotp(r),i=this.getHMAC8(n);if(Re(t.hmac,i))return t.data=n,t;console.log("Invalid HMAC",t.hmac,i)}catch(e){console.log("unpack err",e)}else console.log("Invalid LEN data_len: data.byteLen",t,e.byteLength)}}var at=pe.Buffer,ft=Object.freeze({__proto__:null,Buffer:at,HASH_POWER:nt,MBP:Ve,Meta:Ye,MetaSize:Je,MsgType:qe,RAND:rt,SEA:ot,getHashSpeed:et,hexlog:function(e,t){console.log(e,Ne(t))},printHashPerformance:function(e){const t=et(e);let r;for(let e=["K","M","G","T","P","E","Z","Y"],n=0,i=t/1024;i>1;i/=1024,n++)r=i.toFixed(3)+" "+e[n]+"H/s ( "+t+" hash/sec )";return"sha256 hash power: "+r},sha256:Z,get webCrypto(){return Xe},webCryptoTest:function(){if("object"!=typeof Xe.subtle)console.log("No WebCrypto API supported.");else{console.log("webCrypto test:");const e=Xe.getRandomValues(new Uint8Array(8));console.log("1. getRandomValues: ",e),Xe.subtle.digest("SHA-256",e).then((t=>{const r=Ne(t),n=Z.hex(e);if(console.log("A.Compare binary hash sums"),console.log("1. subtle.digest.sha256: ",r),console.log("2. js.sha256: ",n),r!==n)throw new Error("diffrent hash result");console.log("binary hash test: success.")}));const t=Ne(e);Xe.subtle.digest("SHA-256",Ze.encode(t)).then((e=>{const r=Ne(e),n=Z.hex(t);if(console.log("B.Compare string hash sums"),console.log("1. subtle.digest.sha256: ",r),console.log("2. js.sha256: ",n),r!==n)throw new Error("diffrent hash result");console.log("string hash test: success.")}))}}});let ht=null,ct={NO:0,YES:1,AUTO:2};for(let e in ct)ct[ct[e]]=e;const ut=new TextEncoder,lt=new TextDecoder,pt=M,dt=D,gt=$;class yt extends q{static BOHO=ft;constructor(e,t=[]){super(),this.ws,this.sea=new ot,this.isSecureLine=!1,this.encMode=ct.AUTO,this.nick="",this.lsid=yt.getID(),this.protocols=t,this.lastState=!1,this.maxPayload=1e3,this.serverURL=e,this.txCounter=0,this.rxCounter=0,this.lastTxRxTime=Date.now(),this.lastTxRxTimeOut=65e3,this.runCheckPeriod=3e3,this.runCheckIntervalID=null,this.isNode=!1,this.channels=new Set,this.promiseMap=new Map,this.promiseTimeOut=2e3,this.mid=0,"undefined"==typeof WebSocket&&(this.isNode=!0),yt.ls.add(this),this.connect()}static ls=new Set;static ID=1;static NodeWebSocket;static getID(){return yt.ID++}static getByteSize(e){return y(e)}static timeStamp(){return g()}static buf2hex(e){return function(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}(e)}static PU8(e){return z(e)}runChecker(e){if(1!=this.ws?.readyState)this.connect();else{Date.now()-this.lastTxRxTime>this.lastTxRxTimeOut&&this.echo()}}close(){this.ws?.close(1e3,"well done"),this.ws=null,clearInterval(this.runCheckIntervalID),this.runCheckIntervalID=null}open(e){this.connect(e)}connect(e){e&&(this.serverURL=e),this.runCheckIntervalID&&clearInterval(this.runCheckIntervalID),this.runCheckIntervalID=setInterval(this.runChecker.bind(this),this.runCheckPeriod),console.log("+"),this.ws?.close(),this.ws=null,this.isNode?(this.ws=new yt.NodeWebSocket(this.serverURL,this.protocols),this.ws.on("message",this.onWebSocketMessage.bind(this))):(this.ws=new WebSocket(this.serverURL,this.protocols),this.ws.addEventListener("message",this.onWebSocketMessage.bind(this))),this.ws.binaryType="arraybuffer",this.ws.onopen=e=>{this.serverURL.includes("wss://")&&(this.isSecureLine=!0),this.subscribeChannelsToServer(),this.lastState||this.emit("statechange","open"),this.lastState=!0,this.emit("open","open")},this.ws.onerror=e=>{this.isNode&&console.log("e.error message",e.message)},this.ws.onclose=e=>{console.log("e.close  code,reason",e.code,e.reason),this.isSecre=!1,this.lastState&&this.emit("statechange","close"),this.lastState=!1,this.emit("close","close"),1009===e.code&&console.log("  . Over maxPayload size")}}subscribeChannelsToServer(){if(this.channels.size>0){let e=Array.from(this.channels).join(",");this.sub_str_ch(e)}}onWebSocketMessage(e,t){let r;this.rxCounter++,this.lastTxRxTime=Date.now(),this.isNode?(r=e,t||(r=(new TextDecoder).decode(r))):(r=e.data,t=r instanceof ArrayBuffer),t&&this.binaryMessageParser(O.Buffer.from(r)),this.emit("message",r,t)}binaryMessageParser(e){let t,r=e[0];switch(console.log("MsgType: ",qe[r]," LEN ",e.byteLength),r===qe.ENC_0808&&(t=this.sea.decrypt_remote_type_0808(e),t?(console.log(t),r=t[0],e=t,console.log("DECODED MsgType:",qe[r])):console.log("DEC_FAIL",e.byteLength)),r){case qe.IAM_RES:let t=W(e,Ye.IAM_RES);if(t){let e=(new TextDecoder).decode(t.$OTHERS),r=JSON.parse(e);console.log("unpack iam.info",r)}break;case qe.PUB_STR_CH:try{let t=e.readUint8(1),r=e.subarray(2,2+t),n=lt.decode(r),i=e.subarray(2+t),s=lt.decode(i);console.log("rcv pub_str_ch",n),console.log("rcv pub_str_ch str payload",s),this.emit(n,n,s)}catch(e){console.log("pub_str_ch err",e)}break;case qe.PUB_STR_CH_RET:let r=W(e);if(r){let e=lt.decode(r.chInfo),t=r.args;console.log("pub_str_ret msg ...args",...t),this.emit(e,e,...t)}break;case qe.RES_MID_CODE_MBP:let n=e.readUint8(1),i=e.readUint16BE(2),s=e.byteLength>4?e.subarray(4):"";console.log(`[RES] MID: ${i} CODE: ${n} `),this.testPromise(i,n,s);break;case qe.AUTH_REQ:let o=this.sea.auth_hmac(e);o?this.send(o):(console.log("Invalid auth_req"),this.close());break;case qe.AUTH_FAIL:console.log("SERVER REJECT");break;case qe.AUTH_ACK:this.sea.check_auth_ack_hmac(e)?this.emit("authorized","authorized"):(console.log("invalid server hmac"),this.close())}}iam(e){console.log("iam",e),e?this.send_enc_mode(j(dt("#cmd","8",qe.IAM),dt("#",e))):this.send_enc_mode(j(dt("#cmd","8",qe.IAM)))}echo(e){e?(console.log("echo args:",e),this.send_enc_mode(j(dt("#type","8",qe.ECHO),dt("#msg",e)))):this.send(O.Buffer.from([qe.ECHO]))}bin(...e){this.send(G(...e))}send_enc_mode(e,t=!1){if((this.encMode===ct.YES||this.encMode===ct.AUTO&&!this.isSecureLine&&this.sea.isAuthorized)&&(t=!0),t){console.log("send *S*");let t=this.sea.encrypt_remote_type_0808(e);this.send(t)}else console.log("send -N-"),this.send(e)}send(e){1===this.ws?.readyState&&(this.txCounter++,this.lastTxRxTime=Date.now(),this.ws.send(e))}setMsgPromise(e){return new Promise(((t,r)=>{this.promiseMap.set(e,[t,r]),setTimeout((t=>{this.promiseMap.has(e)&&(r("timeout"),this.promiseMap.delete(e))}),this.promiseTimeOut)}))}testPromise(e,t,r){if(this.promiseMap.has(e)){console.log("res promise msg",e);let[n,i]=this.promiseMap.get(e);this.promiseMap.delete(e);let s=W(r);s?t<128?n(s):i(s):i()}}publish(e,...t){let r=this.pub_str_ch_ret(e,...t);return this.setMsgPromise(r)}pub(...e){return this.pub_str_ch_ret(...e)}pub_str_ch(e,t){if("string"!=typeof e)throw"first parameter : channelName should be string.";let r=ut.encode(e);this.send_enc_mode(j(dt("#cmd","8",qe.PUB_STR_CH),dt("#chLen","8",r.byteLength),dt("#chInfo",r),dt("#oneArgument",t)))}pub_str_ch_ret(e,...t){if("string"!=typeof e)throw"first parameter : channelName should be string.";let r=ut.encode(e);return this.send_enc_mode(j(dt("#cmd","8",qe.PUB_STR_CH_RET),dt("#mid","16",++this.mid),dt("#chLen","16",r.byteLength),dt("chInfo",r),gt(...t))),this.mid}subscribe(e,t){let r=this.sub(e,t);return this.setMsgPromise(r)}sub(...e){return this.sub_str_ch_ret(...e)}sub_str_ch_ret(e,t){if("string"!=typeof e)throw"first parameter : channelName should be string.";let r=ut.encode(e);return this.send_enc_mode(O.Buffer.concat([pt("8",qe.SUB_STR_CH_RET),pt("16",++this.mid),pt("16",r.byteLength),r])),this.channels.add(e),t&&this.on(e,t),this.mid}sub_str_ch(e,t){if("string"!=typeof e)throw"first parameter : channelName should be string.";let r=ut.encode(e);this.send_enc_mode(O.Buffer.concat([pt("8",qe.SUB_STR_CH),pt("8",r.byteLength),r])),this.channels.add(e),t&&this.on(e,t)}unsub_str_ch(e=""){if(console.log("unsub",e),"string"!=typeof e)throw"unsub first parameter : channelName should be string.";this.channels.delete(e),this.removeAllListeners(e);let t=ut.encode(e);this.send_enc_mode(O.Buffer.concat([pt("8",qe.UNSUB),pt("8",t.byteLength),t]))}}var _t={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},mt="function"==typeof __webpack_require__?__non_webpack_require__:m,bt=process.config&&process.config.variables||{},wt=!!process.env.PREBUILDS_ONLY,Et=process.versions.modules,vt=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":process.versions&&process.versions.nw?"node-webkit":"node",Bt=a.arch(),St=a.platform(),At=process.env.LIBC||(function(e){return"linux"===e&&s.existsSync("/etc/alpine-release")}(St)?"musl":"glibc"),Lt=process.env.ARM_VERSION||("arm64"===Bt?"8":bt.arm_version)||"",It=(process.versions.uv||"").split(".")[0],xt=Ut;function Ut(e){return mt(Ut.path(e))}function Tt(e){try{return s.readdirSync(e)}catch(e){return[]}}function kt(e,t){var r=Tt(e).filter(t);return r[0]&&o.join(e,r[0])}function Ct(e){return/\.node$/.test(e)}function Ot(e){var t=e.split("-");if(2===t.length){var r=t[0],n=t[1].split("+");if(r&&n.length&&n.every(Boolean))return{name:e,platform:r,architectures:n}}}function Nt(e,t){return function(r){return null!=r&&(r.platform===e&&r.architectures.includes(t))}}function Rt(e,t){return e.architectures.length-t.architectures.length}function Mt(e){var t=e.split("."),r={file:e,specificity:0};if("node"===t.pop()){for(var n=0;n<t.length;n++){var i=t[n];if("node"===i||"electron"===i||"node-webkit"===i)r.runtime=i;else if("napi"===i)r.napi=!0;else if("abi"===i.slice(0,3))r.abi=i.slice(3);else if("uv"===i.slice(0,2))r.uv=i.slice(2);else if("armv"===i.slice(0,4))r.armv=i.slice(4);else{if("glibc"!==i&&"musl"!==i)continue;r.libc=i}r.specificity++}return r}}function Pt(e,t){return function(r){return null!=r&&(!(r.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(r))&&(!(r.abi!==t&&!r.napi)&&((!r.uv||r.uv===It)&&((!r.armv||r.armv===Lt)&&(!r.libc||r.libc===At)))))}}function Dt(e){return function(t,r){return t.runtime!==r.runtime?t.runtime===e?-1:1:t.abi!==r.abi?t.abi?-1:1:t.specificity!==r.specificity?t.specificity>r.specificity?-1:1:0}}Ut.path=function(e){e=o.resolve(e||".");try{var t=mt(o.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!wt){var r=kt(o.join(e,"build/Release"),Ct);if(r)return r;var n=kt(o.join(e,"build/Debug"),Ct);if(n)return n}var i=f(e);if(i)return i;var s=f(o.dirname(process.execPath));if(s)return s;var a=["platform="+St,"arch="+Bt,"runtime="+vt,"abi="+Et,"uv="+It,Lt?"armv="+Lt:"","libc="+At,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"","function"==typeof __webpack_require__?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+a+"\n    loaded from: "+e+"\n");function f(e){var t=Tt(o.join(e,"prebuilds")).map(Ot).filter(Nt(St,Bt)).sort(Rt)[0];if(t){var r=o.join(e,"prebuilds",t.name),n=Tt(r).map(Mt).filter(Pt(vt,Et)).sort(Dt(vt))[0];return n?o.join(r,n.file):void 0}}},Ut.parseTags=Mt,Ut.matchTags=Pt,Ut.compareTags=Dt,Ut.parseTuple=Ot,Ut.matchTuple=Nt,Ut.compareTuples=Rt;var $t={mask:(e,t,r,n,i)=>{for(var s=0;s<i;s++)r[n+s]=e[s]^t[3&s]},unmask:(e,t)=>{const r=e.length;for(var n=0;n<r;n++)e[n]^=t[3&n]}},Ht=_((function(e){try{e.exports=xt(__dirname)}catch(t){e.exports=$t}})),Ft=_((function(e){const{EMPTY_BUFFER:t}=_t;function r(e,t,r,n,i){for(let s=0;s<i;s++)r[n+s]=e[s]^t[3&s]}function n(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}if(e.exports={concat:function(e,r){if(0===e.length)return t;if(1===e.length)return e[0];const n=Buffer.allocUnsafe(r);let i=0;for(let t=0;t<e.length;t++){const r=e[t];n.set(r,i),i+=r.length}return i<r?n.slice(0,i):n},mask:r,toArrayBuffer:function(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let r;return t instanceof ArrayBuffer?r=Buffer.from(t):ArrayBuffer.isView(t)?r=Buffer.from(t.buffer,t.byteOffset,t.byteLength):(r=Buffer.from(t),e.readOnly=!1),r},unmask:n},!process.env.WS_NO_BUFFER_UTIL)try{const t=Ht;e.exports.mask=function(e,n,i,s,o){o<48?r(e,n,i,s,o):t.mask(e,n,i,s,o)},e.exports.unmask=function(e,r){e.length<32?n(e,r):t.unmask(e,r)}}catch(e){}}));const jt=Symbol("kDone"),Wt=Symbol("kRun");var zt=class{constructor(e){this[jt]=()=>{this.pending--,this[Wt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Wt]()}[Wt](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[jt])}}};const{kStatusCode:Vt}=_t,Gt=Buffer.from([0,0,255,255]),qt=Symbol("permessage-deflate"),Yt=Symbol("total-length"),Kt=Symbol("callback"),Jt=Symbol("buffers"),Xt=Symbol("error");let Zt;var Qt=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Zt){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;Zt=new zt(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[Kt];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==r)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}e[t]=r}))})),e}decompress(e,t,r){Zt.add((n=>{this._decompress(e,t,((e,t)=>{n(),r(e,t)}))}))}compress(e,t,r){Zt.add((n=>{this._compress(e,t,((e,t)=>{n(),r(e,t)}))}))}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[qt]=this,this._inflate[Yt]=0,this._inflate[Jt]=[],this._inflate.on("error",rr),this._inflate.on("data",tr)}this._inflate[Kt]=r,this._inflate.write(e),t&&this._inflate.write(Gt),this._inflate.flush((()=>{const e=this._inflate[Xt];if(e)return this._inflate.close(),this._inflate=null,void r(e);const i=Ft.concat(this._inflate[Jt],this._inflate[Yt]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Yt]=0,this._inflate[Jt]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,i)}))}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const e=`${n}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[Yt]=0,this._deflate[Jt]=[],this._deflate.on("data",er)}this._deflate[Kt]=r,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=Ft.concat(this._deflate[Jt],this._deflate[Yt]);t&&(e=e.slice(0,e.length-4)),this._deflate[Kt]=null,this._deflate[Yt]=0,this._deflate[Jt]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,e)}))}};function er(e){this[Jt].push(e),this[Yt]+=e.length}function tr(e){this[Yt]+=e.length,this[qt]._maxPayload<1||this[Yt]<=this[qt]._maxPayload?this[Jt].push(e):(this[Xt]=new RangeError("Max payload size exceeded"),this[Xt].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Xt][Vt]=1009,this.removeListener("data",tr),this.reset())}function rr(e){this[qt]._inflate=null,e[Vt]=1007,this[Kt](e)}var nr=function(e){const t=e.length;let r=0;for(;r<t;)if(0==(128&e[r]))r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0},ir=_((function(e){try{e.exports=xt(__dirname)}catch(t){e.exports=nr}})),sr=_((function(e){function t(e){const t=e.length;let r=0;for(;r<t;)if(0==(128&e[r]))r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(e.exports={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:t,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},!process.env.WS_NO_UTF_8_VALIDATE)try{const r=ir;e.exports.isValidUTF8=function(e){return e.length<150?t(e):r(e)}}catch(e){}}));const{Writable:or}=n,{BINARY_TYPES:ar,EMPTY_BUFFER:fr,kStatusCode:hr,kWebSocket:cr}=_t,{concat:ur,toArrayBuffer:lr,unmask:pr}=Ft,{isValidStatusCode:dr,isValidUTF8:gr}=sr;var yr=class extends or{constructor(e={}){super(),this._binaryType=e.binaryType||ar[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[cr]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,_r(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=64==(64&e[0]);if(t&&!this._extensions[Qt.extensionName])return this._loop=!1,_r(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,_r(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,_r(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,_r(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,_r(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,_r(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,_r(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,_r(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,_r(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,_r(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,_r(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,_r(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=fr;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!=(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&pr(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[Qt.extensionName].decompress(e,this._fin,((e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(_r(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(r)}const n=this.dataMessage();if(n)return t(n);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?ur(t,e):"arraybuffer"===this._binaryType?lr(ur(t,e)):t,this.emit("message",r,!0)}else{const r=ur(t,e);if(!this._skipUTF8Validation&&!gr(r))return this._loop=!1,_r(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,fr),this.end();else{if(1===e.length)return _r(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!dr(t))return _r(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!gr(r))return _r(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}};function _r(e,t,r,n,i){const s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,_r),s.code=i,s[hr]=n,s}const{randomFillSync:mr}=e,{EMPTY_BUFFER:br}=_t,{isValidStatusCode:wr}=sr,{mask:Er,toBuffer:vr}=Ft,Br=Symbol("kByteLength"),Sr=Buffer.alloc(4);class Ar{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,n,i=!1,s=2,o=!1;t.mask&&(r=t.maskBuffer||Sr,t.generateMask?t.generateMask(r):mr(r,0,4),o=0==(r[0]|r[1]|r[2]|r[3]),s=6),"string"==typeof e?n=t.mask&&!o||void 0===t[Br]?(e=Buffer.from(e)).length:t[Br]:(n=e.length,i=t.mask&&t.readOnly&&!o);let a=n;n>=65536?(s+=8,a=127):n>125&&(s+=2,a=126);const f=Buffer.allocUnsafe(i?n+s:s);return f[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(f[0]|=64),f[1]=a,126===a?f.writeUInt16BE(n,2):127===a&&(f[2]=f[3]=0,f.writeUIntBE(n,4,6)),t.mask?(f[1]|=128,f[s-4]=r[0],f[s-3]=r[1],f[s-2]=r[2],f[s-1]=r[3],o?[f,e]:i?(Er(e,r,f,s,n),[f]):(Er(e,r,e,0,n),[f,e])):[f,e]}close(e,t,r,n){let i;if(void 0===e)i=br;else{if("number"!=typeof e||!wr(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const r=Buffer.byteLength(t);if(r>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+r),i.writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0)}const s={[Br]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,s,n]):this.sendFrame(Ar.frame(i,s),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):(n=(e=vr(e)).length,i=vr.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const s={[Br]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(Ar.frame(e,s),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):(n=(e=vr(e)).length,i=vr.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const s={[Br]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,s,r]):this.sendFrame(Ar.frame(e,s),r)}send(e,t,r){const n=this._extensions[Qt.extensionName];let i,s,o=t.binary?2:1,a=t.compress;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):(i=(e=vr(e)).length,s=vr.readOnly),this._firstFragment?(this._firstFragment=!1,a&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=i>=n._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),n){const n={[Br]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:s,rsv1:a};this._deflating?this.enqueue([this.dispatch,e,this._compress,n,r]):this.dispatch(e,this._compress,n,r)}else this.sendFrame(Ar.frame(e,{[Br]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:o,readOnly:s,rsv1:!1}),r)}dispatch(e,t,r,n){if(!t)return void this.sendFrame(Ar.frame(e,r),n);const i=this._extensions[Qt.extensionName];this._bufferedBytes+=r[Br],this._deflating=!0,i.compress(e,r.fin,((e,t)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof n&&n(e);for(let t=0;t<this._queue.length;t++){const r=this._queue[t],n=r[r.length-1];"function"==typeof n&&n(e)}}else this._bufferedBytes-=r[Br],this._deflating=!1,r.readOnly=!1,this.sendFrame(Ar.frame(t,r),n),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][Br],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][Br],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Lr=Ar;const{kForOnEventAttribute:Ir,kListener:xr}=_t,Ur=Symbol("kCode"),Tr=Symbol("kData"),kr=Symbol("kError"),Cr=Symbol("kMessage"),Or=Symbol("kReason"),Nr=Symbol("kTarget"),Rr=Symbol("kType"),Mr=Symbol("kWasClean");class Pr{constructor(e){this[Nr]=null,this[Rr]=e}get target(){return this[Nr]}get type(){return this[Rr]}}Object.defineProperty(Pr.prototype,"target",{enumerable:!0}),Object.defineProperty(Pr.prototype,"type",{enumerable:!0});class Dr extends Pr{constructor(e,t={}){super(e),this[Ur]=void 0===t.code?0:t.code,this[Or]=void 0===t.reason?"":t.reason,this[Mr]=void 0!==t.wasClean&&t.wasClean}get code(){return this[Ur]}get reason(){return this[Or]}get wasClean(){return this[Mr]}}Object.defineProperty(Dr.prototype,"code",{enumerable:!0}),Object.defineProperty(Dr.prototype,"reason",{enumerable:!0}),Object.defineProperty(Dr.prototype,"wasClean",{enumerable:!0});class $r extends Pr{constructor(e,t={}){super(e),this[kr]=void 0===t.error?null:t.error,this[Cr]=void 0===t.message?"":t.message}get error(){return this[kr]}get message(){return this[Cr]}}Object.defineProperty($r.prototype,"error",{enumerable:!0}),Object.defineProperty($r.prototype,"message",{enumerable:!0});class Hr extends Pr{constructor(e,t={}){super(e),this[Tr]=void 0===t.data?null:t.data}get data(){return this[Tr]}}Object.defineProperty(Hr.prototype,"data",{enumerable:!0});const Fr={addEventListener(e,t,r={}){let n;if("message"===e)n=function(e,r){const n=new Hr("message",{data:r?e:e.toString()});n[Nr]=this,t.call(this,n)};else if("close"===e)n=function(e,r){const n=new Dr("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[Nr]=this,t.call(this,n)};else if("error"===e)n=function(e){const r=new $r("error",{error:e,message:e.message});r[Nr]=this,t.call(this,r)};else{if("open"!==e)return;n=function(){const e=new Pr("open");e[Nr]=this,t.call(this,e)}}n[Ir]=!!r[Ir],n[xr]=t,r.once?this.once(e,n):this.on(e,n)},removeEventListener(e,t){for(const r of this.listeners(e))if(r[xr]===t&&!r[Ir]){this.removeListener(e,r);break}}};var jr={CloseEvent:Dr,ErrorEvent:$r,Event:Pr,EventTarget:Fr,MessageEvent:Hr};const{tokenChars:Wr}=sr;function zr(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}var Vr={format:function(e){return Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>[t].concat(Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let r,n,i=Object.create(null),s=!1,o=!1,a=!1,f=-1,h=-1,c=-1,u=0;for(;u<e.length;u++)if(h=e.charCodeAt(u),void 0===r)if(-1===c&&1===Wr[h])-1===f&&(f=u);else if(0===u||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${u}`);{if(-1===f)throw new SyntaxError(`Unexpected character at index ${u}`);-1===c&&(c=u);const n=e.slice(f,c);44===h?(zr(t,n,i),i=Object.create(null)):r=n,f=c=-1}}else-1===c&&-1!==f&&(c=u);else if(void 0===n)if(-1===c&&1===Wr[h])-1===f&&(f=u);else if(32===h||9===h)-1===c&&-1!==f&&(c=u);else if(59===h||44===h){if(-1===f)throw new SyntaxError(`Unexpected character at index ${u}`);-1===c&&(c=u),zr(i,e.slice(f,c),!0),44===h&&(zr(t,r,i),i=Object.create(null),r=void 0),f=c=-1}else{if(61!==h||-1===f||-1!==c)throw new SyntaxError(`Unexpected character at index ${u}`);n=e.slice(f,u),f=c=-1}else if(o){if(1!==Wr[h])throw new SyntaxError(`Unexpected character at index ${u}`);-1===f?f=u:s||(s=!0),o=!1}else if(a)if(1===Wr[h])-1===f&&(f=u);else if(34===h&&-1!==f)a=!1,c=u;else{if(92!==h)throw new SyntaxError(`Unexpected character at index ${u}`);o=!0}else if(34===h&&61===e.charCodeAt(u-1))a=!0;else if(-1===c&&1===Wr[h])-1===f&&(f=u);else if(-1===f||32!==h&&9!==h){if(59!==h&&44!==h)throw new SyntaxError(`Unexpected character at index ${u}`);{if(-1===f)throw new SyntaxError(`Unexpected character at index ${u}`);-1===c&&(c=u);let o=e.slice(f,c);s&&(o=o.replace(/\\/g,""),s=!1),zr(i,n,o),44===h&&(zr(t,r,i),i=Object.create(null),r=void 0),n=void 0,f=c=-1}}else-1===c&&(c=u);if(-1===f||a||32===h||9===h)throw new SyntaxError("Unexpected end of input");-1===c&&(c=u);const l=e.slice(f,c);return void 0===r?zr(t,l,i):(void 0===n?zr(i,l,!0):zr(i,n,s?l.replace(/\\/g,""):l),zr(t,r,i)),t}};const{randomBytes:Gr,createHash:qr}=e,{URL:Yr}=p,{BINARY_TYPES:Kr,EMPTY_BUFFER:Jr,GUID:Xr,kForOnEventAttribute:Zr,kListener:Qr,kStatusCode:en,kWebSocket:tn,NOOP:rn}=_t,{EventTarget:{addEventListener:nn,removeEventListener:sn}}=jr,{format:on,parse:an}=Vr,{toBuffer:fn}=Ft,hn=Symbol("kAborted"),cn=[8,13],un=["CONNECTING","OPEN","CLOSING","CLOSED"],ln=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class pn extends c{constructor(e,t,r){super(),this._binaryType=Kr[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Jr,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=pn.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),gn(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Kr.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new yr({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new Lr(e,this._extensions,r.generateMask),this._receiver=n,this._socket=e,n[tn]=this,e[tn]=this,n.on("conclude",En),n.on("drain",vn),n.on("error",Bn),n.on("message",An),n.on("ping",Ln),n.on("pong",In),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Un),e.on("data",Tn),e.on("end",kn),e.on("error",Cn),this._readyState=pn.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=pn.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[Qt.extensionName]&&this._extensions[Qt.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=pn.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==pn.CLOSED){if(this.readyState===pn.CONNECTING){const e="WebSocket was closed before the connection was established";return bn(this,this._req,e)}this.readyState!==pn.CLOSING?(this._readyState=pn.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==pn.CONNECTING&&this.readyState!==pn.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===pn.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===pn.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||Jr,t,r)):wn(this,e,r)}pong(e,t,r){if(this.readyState===pn.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===pn.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||Jr,t,r)):wn(this,e,r)}resume(){this.readyState!==pn.CONNECTING&&this.readyState!==pn.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===pn.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==pn.OPEN)return void wn(this,e,r);const n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[Qt.extensionName]||(n.compress=!1),this._sender.send(e||Jr,n,r)}terminate(){if(this.readyState!==pn.CLOSED){if(this.readyState===pn.CONNECTING){const e="WebSocket was closed before the connection was established";return bn(this,this._req,e)}this._socket&&(this._readyState=pn.CLOSING,this._socket.destroy())}}}Object.defineProperty(pn,"CONNECTING",{enumerable:!0,value:un.indexOf("CONNECTING")}),Object.defineProperty(pn.prototype,"CONNECTING",{enumerable:!0,value:un.indexOf("CONNECTING")}),Object.defineProperty(pn,"OPEN",{enumerable:!0,value:un.indexOf("OPEN")}),Object.defineProperty(pn.prototype,"OPEN",{enumerable:!0,value:un.indexOf("OPEN")}),Object.defineProperty(pn,"CLOSING",{enumerable:!0,value:un.indexOf("CLOSING")}),Object.defineProperty(pn.prototype,"CLOSING",{enumerable:!0,value:un.indexOf("CLOSING")}),Object.defineProperty(pn,"CLOSED",{enumerable:!0,value:un.indexOf("CLOSED")}),Object.defineProperty(pn.prototype,"CLOSED",{enumerable:!0,value:un.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(pn.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(pn.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[Zr])return t[Qr];return null},set(t){for(const t of this.listeners(e))if(t[Zr]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[Zr]:!0})}})})),pn.prototype.addEventListener=nn,pn.prototype.removeEventListener=sn;var dn=pn;function gn(e,t,r,n){const i={protocolVersion:cn[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!cn.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${cn.join(", ")})`);let s;if(t instanceof Yr)s=t,e._url=t.href;else{try{s=new Yr(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}e._url=t}const o="wss:"===s.protocol,a="ws+unix:"===s.protocol;let f;if("ws:"===s.protocol||o||a?a&&!s.pathname?f="The URL's pathname is empty":s.hash&&(f="The URL contains a fragment identifier"):f='The URL\'s protocol must be one of "ws:", "wss:", or "ws+unix:"',f){const t=new SyntaxError(f);if(0===e._redirects)throw t;return void yn(e,t)}const h=o?443:80,c=Gr(16).toString("base64"),p=o?u.request:l.request,d=new Set;let g,y;if(i.createConnection=o?mn:_n,i.defaultPort=i.defaultPort||h,i.port=s.port||h,i.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,i.headers={"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket",...i.headers},i.path=s.pathname+s.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(g=new Qt(!0!==i.perMessageDeflate?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=on({[Qt.extensionName]:g.offer()})),r.length){for(const e of r){if("string"!=typeof e||!ln.test(e)||d.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");d.add(e)}i.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(s.username||s.password)&&(i.auth=`${s.username}:${s.password}`),a){const e=i.path.split(":");i.socketPath=e[0],i.path=e[1]}if(i.followRedirects){if(0===e._redirects){e._originalSecure=o,e._originalHost=s.host;const t=n&&n.headers;if(n={...n,headers:{}},t)for(const[e,r]of Object.entries(t))n.headers[e.toLowerCase()]=r}else if(0===e.listenerCount("redirect")){const t=s.host===e._originalHost;(!t||e._originalSecure&&!o)&&(delete i.headers.authorization,delete i.headers.cookie,t||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),y=e._req=p(i),e._redirects&&e.emit("redirect",e.url,y)}else y=e._req=p(i);i.timeout&&y.on("timeout",(()=>{bn(e,y,"Opening handshake has timed out")})),y.on("error",(t=>{null===y||y[hn]||(y=e._req=null,yn(e,t))})),y.on("response",(s=>{const o=s.headers.location,a=s.statusCode;if(o&&i.followRedirects&&a>=300&&a<400){if(++e._redirects>i.maxRedirects)return void bn(e,y,"Maximum redirects exceeded");let s;y.abort();try{s=new Yr(o,t)}catch(t){const r=new SyntaxError(`Invalid URL: ${o}`);return void yn(e,r)}gn(e,s,r,n)}else e.emit("unexpected-response",y,s)||bn(e,y,`Unexpected server response: ${s.statusCode}`)})),y.on("upgrade",((t,r,n)=>{if(e.emit("upgrade",t),e.readyState!==pn.CONNECTING)return;if(y=e._req=null,"websocket"!==t.headers.upgrade.toLowerCase())return void bn(e,r,"Invalid Upgrade header");const s=qr("sha1").update(c+Xr).digest("base64");if(t.headers["sec-websocket-accept"]!==s)return void bn(e,r,"Invalid Sec-WebSocket-Accept header");const o=t.headers["sec-websocket-protocol"];let a;if(void 0!==o?d.size?d.has(o)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":d.size&&(a="Server sent no subprotocol"),a)return void bn(e,r,a);o&&(e._protocol=o);const f=t.headers["sec-websocket-extensions"];if(void 0!==f){if(!g){return void bn(e,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=an(f)}catch(t){return void bn(e,r,"Invalid Sec-WebSocket-Extensions header")}const n=Object.keys(t);if(1!==n.length||n[0]!==Qt.extensionName){return void bn(e,r,"Server indicated an extension that was not requested")}try{g.accept(t[Qt.extensionName])}catch(t){return void bn(e,r,"Invalid Sec-WebSocket-Extensions header")}e._extensions[Qt.extensionName]=g}e.setSocket(r,n,{generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})})),y.end()}function yn(e,t){e._readyState=pn.CLOSING,e.emit("error",t),e.emitClose()}function _n(e){return e.path=e.socketPath,f.connect(e)}function mn(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=f.isIP(e.host)?"":e.host),h.connect(e)}function bn(e,t,r){e._readyState=pn.CLOSING;const n=new Error(r);Error.captureStackTrace(n,bn),t.setHeader?(t[hn]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(yn,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function wn(e,t,r){if(t){const r=fn(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){r(new Error(`WebSocket is not open: readyState ${e.readyState} (${un[e.readyState]})`))}}function En(e,t){const r=this[tn];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[tn]&&(r._socket.removeListener("data",Tn),process.nextTick(xn,r._socket),1005===e?r.close():r.close(e,t))}function vn(){const e=this[tn];e.isPaused||e._socket.resume()}function Bn(e){const t=this[tn];void 0!==t._socket[tn]&&(t._socket.removeListener("data",Tn),process.nextTick(xn,t._socket),t.close(e[en])),t.emit("error",e)}function Sn(){this[tn].emitClose()}function An(e,t){this[tn].emit("message",e,t)}function Ln(e){const t=this[tn];t.pong(e,!t._isServer,rn),t.emit("ping",e)}function In(e){this[tn].emit("pong",e)}function xn(e){e.resume()}function Un(){const e=this[tn];let t;this.removeListener("close",Un),this.removeListener("data",Tn),this.removeListener("end",kn),e._readyState=pn.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[tn]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",Sn),e._receiver.on("finish",Sn))}function Tn(e){this[tn]._receiver.write(e)||this.pause()}function kn(){const e=this[tn];e._readyState=pn.CLOSING,e._receiver.end(),this.end()}function Cn(){const e=this[tn];this.removeListener("error",Cn),this.on("error",rn),e&&(e._readyState=pn.CLOSING,this.destroy())}const{tokenChars:On}=sr;var Nn={parse:function(e){const t=new Set;let r=-1,n=-1,i=0;for(;i<e.length;i++){const s=e.charCodeAt(i);if(-1===n&&1===On[s])-1===r&&(r=i);else if(0===i||32!==s&&9!==s){if(44!==s)throw new SyntaxError(`Unexpected character at index ${i}`);{if(-1===r)throw new SyntaxError(`Unexpected character at index ${i}`);-1===n&&(n=i);const s=e.slice(r,n);if(t.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);t.add(s),r=n=-1}}else-1===n&&-1!==r&&(n=i)}if(-1===r||-1!==n)throw new SyntaxError("Unexpected end of input");const s=e.slice(r,i);if(t.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}};const{createHash:Rn}=e,{GUID:Mn,kWebSocket:Pn}=_t,Dn=/^[+/0-9A-Za-z]{22}==$/;var $n=class extends c{constructor(e,t){if(super(),null==(e={maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:dn,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=l.createServer(((e,t)=>{const r=l.STATUS_CODES[426];t.writeHead(426,{"Content-Length":r.length,"Content-Type":"text/plain"}),t.end(r)})),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const r of Object.keys(t))e.on(r,t[r]);return function(){for(const r of Object.keys(t))e.removeListener(r,t[r])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,r,n)=>{this.handleUpgrade(t,r,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",(()=>{e(new Error("The server is not running"))})),void process.nextTick(Hn,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(Hn,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close((()=>{Hn(this)}))}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",Fn);const i=e.headers["sec-websocket-key"],s=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void Wn(this,e,t,405,"Invalid HTTP method")}if("websocket"!==e.headers.upgrade.toLowerCase()){return void Wn(this,e,t,400,"Invalid Upgrade header")}if(!i||!Dn.test(i)){return void Wn(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(8!==s&&13!==s){return void Wn(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header")}if(!this.shouldHandle(e))return void jn(t,400);const o=e.headers["sec-websocket-protocol"];let a=new Set;if(void 0!==o)try{a=Nn.parse(o)}catch(r){return void Wn(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const f=e.headers["sec-websocket-extensions"],h={};if(this.options.perMessageDeflate&&void 0!==f){const r=new Qt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=Vr.parse(f);e[Qt.extensionName]&&(r.accept(e[Qt.extensionName]),h[Qt.extensionName]=r)}catch(r){return void Wn(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[""+(8===s?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,((s,o,f,c)=>{if(!s)return jn(t,o||401,f,c);this.completeUpgrade(h,i,a,e,t,r,n)}));if(!this.options.verifyClient(o))return jn(t,401)}this.completeUpgrade(h,i,a,e,t,r,n)}completeUpgrade(e,t,r,n,i,s,o){if(!i.readable||!i.writable)return i.destroy();if(i[Pn])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return jn(i,503);const a=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Rn("sha1").update(t+Mn).digest("base64")}`],f=new this.options.WebSocket(null);if(r.size){const e=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;e&&(a.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[Qt.extensionName]){const t=e[Qt.extensionName].params,r=Vr.format({[Qt.extensionName]:[t]});a.push(`Sec-WebSocket-Extensions: ${r}`),f._extensions=e}this.emit("headers",a,n),i.write(a.concat("\r\n").join("\r\n")),i.removeListener("error",Fn),f.setSocket(i,s,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",(()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Hn,this)}))),o(f,n)}};function Hn(e){e._state=2,e.emit("close")}function Fn(){this.destroy()}function jn(e,t,r,n){r=r||l.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${l.STATUS_CODES[t]}\r\n`+Object.keys(n).map((e=>`${e}: ${n[e]}`)).join("\r\n")+"\r\n\r\n"+r)}function Wn(e,t,r,n,i){if(e.listenerCount("wsClientError")){const n=new Error(i);Error.captureStackTrace(n,Wn),e.emit("wsClientError",n,r,t)}else jn(r,n,i)}const zn=new Map;function Vn(e,t,r="noname"){let n=function(e){return O.Buffer.from(Z.hash(e)).toString("hex").slice(0,16)}(e),i=function(e){return O.Buffer.from(Z.hash(e))}(t),s=[e,i,r];zn.set(n,s)}function Gn(e){return function(e){let t=zn.get(e);if(t)return t}(e.toString("hex"))}Vn("uno","uno","uno nick"),Vn("esp","esp","esp nick"),new TextEncoder;const qn=new TextDecoder,Yn=M,Kn=D;class Jn{constructor(e,t,r){this.channelManager=r,this.ws=e,this.sea=new ot,this.isSecureLine="https"===t.headers["x-forwarded-proto"],this.encMode=ct.AUTO,this.userID,this.nick,e.isAlive=!0,e.txCounter=0,e.rxCounter=0,e.txBytes=0,e.rxBytes=0,e.openTime=Date.now(),this.lastEchoMessage="begin:"+g(),this.ssid=Jn.getID(),this.remotePort=t.socket.remotePort,this.chMap=new Map,this.ip=this.getClientIP(t),this.privateNode=!1,this.HOME_CHANNEL="",console.log("### server remocon ip:",this.ip),!function(e){if(0===e.indexOf("0.0.0.0"))return!0;if(0===e.indexOf("127.0.0.1"))return!0;if(0===e.indexOf("192.168."))return!0;if(0===e.indexOf("10."))return!0;if(0===e.indexOf("172.")){if(0===e.indexOf("172.16."))return!0;if(0===e.indexOf("172.17."))return!0;if(0===e.indexOf("172.18."))return!0;if(0===e.indexOf("172.19."))return!0;if(0===e.indexOf("172.20."))return!0;if(0===e.indexOf("172.21."))return!0;if(0===e.indexOf("172.22."))return!0;if(0===e.indexOf("172.23."))return!0;if(0===e.indexOf("172.24."))return!0;if(0===e.indexOf("172.25."))return!0;if(0===e.indexOf("172.26."))return!0;if(0===e.indexOf("172.27."))return!0;if(0===e.indexOf("172.28."))return!0;if(0===e.indexOf("172.29."))return!0;if(0===e.indexOf("172.30."))return!0;if(0===e.indexOf("172.31."))return!0}return!1}(this.ip)?this.HOME_CHANNEL=this.channelManager.addToGlobalIPChannel(this):(this.HOME_CHANNEL=this.channelManager.addToPrivateChannel(this),this.privateNode=!0),e.onclose=e=>{this.channelManager.removeClient(this)},e.on("error",(e=>{console.log("ws.onerror",e,e.code)})),e.on("message",this.onWebSocketMessage.bind(this)),e.on("pong",this.receiveMonitor.bind(this)),e.on("ping",this.receiveMonitor.bind(this)),this.send(this.sea.auth_req())}static ssid=1;static getID(){return Jn.ssid++}showMessageLog(e,t){let r="["+this.ssid+this.nick+"] ";if(t){let t="["+qe[e[0]]+"] ";e.byteLength>40?console.log(t+r+" LEN:",e.length):console.log(t+r,e)}else console.log(r+"STR: %s",e)}onWebSocketMessage(e,t){let r,n;if(this.receiveMonitor(e,t),t){if(r=e[0],r===qe.ENC_0808){if(console.log("\n[E]",qe[r]," LEN ",e.byteLength),console.log("ENC buffer",e),n=this.sea.decrypt_remote_type_0808(e),!n)return void console.log("DEC_FAIL",e.byteLength);r=n[0],e=n,console.log("DEC TYPE:",qe[r])}else console.log("\n[P]",qe[r]," LEN ",e.byteLength);switch(r){case qe.AUTH_HMAC:console.log("login inprogress.. auth_hmac");let n=!1,i=W(e,Ye.AUTH_HMAC);if(i){let e=Gn(i.hashID8);if(e){let[t,r,s]=e;console.log("#ID",t),this.sea.setHashID(i.hashID8),this.sea.setHashKey(r);let o=this.sea.check_auth_hmac(i);o&&(n=!0,this.userID=t,this.nick=s,this.send(o),console.log("login success:",`${this.userID}( ${this.nick} )`))}else console.log("NO ID")}n||(console.log("AUTH FAIL"),this.send(Yn("8",qe.AUTH_FAIL)));break;case qe.AUTH_TOCKEN:break;case qe.ECHO:this.send(e,t);break;case qe.LOOP:let s=e.subarray(1);this.send(s,t);break;case qe.IAM:if(e.byteLength>1){let t=e.subarray(1);this.nick=qn.decode(t),console.log("iam nick reset",this.nick)}this.iamResponse();break;case qe.PUB_STR_CH_RET:if(e.byteLength>=6){let r=e.readUInt16BE(1),n=e.readUInt16BE(3);if(e.byteLength>=n+5){let i=e.subarray(5,5+n);i=qn.decode(i);let s,[o,a]=this.channelManager.broadcastTo(i,this,e,t),f=0;"ok"==o?s=j(Kn("receiver","8",a)):(s=j(Kn("result",a)),f=255),this.response(r,f,s)}}break;case qe.PUB_STR_CH:if(e.byteLength>=3){let t=e.readUInt8(1);if(e.byteLength>=t+2){let r=e.subarray(2,2+t);r=qn.decode(r),console.log("pub ch,message:",r,e),this.channelManager.broadcastTo(r,this,e,!0)}}break;case qe.UNSUB:if(2==e.byteLength)this.channelManager.unsubscribe([""],this);else if(e.byteLength>=3){let t=e.readUInt8(1);if(e.byteLength==t+2){let r=e.subarray(2,2+t);r=qn.decode(r),console.log("unsub:  ch",r);let n=r.split(",");this.channelManager.unsubscribe(n,this)}}break;case qe.SUB_STR_CH:if(e.byteLength>=3){let t=e.readUInt8(1);if(e.byteLength==t+2){let r=e.subarray(2,2+t);r=qn.decode(r);let n=r.split(",");this.channelManager.subscribe(n,this)}}break;case qe.SUB_STR_CH_RET:if(e.byteLength>=6){let t=e.readUInt16BE(1),r=e.readUInt8(2);if(e.byteLength==r+5){let n=e.subarray(5,5+r);n=qn.decode(n);let i=n.split(",");this.channelManager.subscribe(i,this),this.response(t,0)}else this.response(t,255)}break;case qe.ADM:console.log("svr",this.isAdmin);break;default:console.log("unknown binary cmd",r,e)}}}receiveMonitor(e,t){this.ws.rxCounter++,this.ws.rxBytes+=e.byteLength+1,this.ws.isAlive=!0}isConnectionHTTPS(e){return e.headers["x-forwarded-proto"]}getClientIP(e){let t=e.headers["x-forwarded-for"],r=e.headers["x-tcp-routed-for"];return null==t&&(t=e.socket.remoteAddress),r&&(t=r),t?(0==t.indexOf("::ffff:")&&(t=t.substring(7)),"::1"==t&&(t="127.0.0.1")):t="0.0.0.0",t}response(e,t,r=new Uint8Array(0)){let n=Buffer.concat([Yn("8",qe.RES_MID_CODE_MBP),Yn("8",t),Yn("16",e),r]);this.send(n)}send_enc_mode(e,t=!1){if((this.encMode===ct.YES||this.encMode===ct.AUTO&&!this.isSecureLine&&this.sea.isAuthorized)&&(t=!0),t){let t=this.sea.encrypt_remote_type_0808(e);t?console.log("send *S* LEN:",t.byteLength):console.log("encryption FAIL:",t),this.send(t)}else console.log("send -N-"),this.send(e)}send(e,t){if(1===this.ws.readyState){let r=y(e);if(0==r)return void console.log("send. size zero");this.ws.txCounter++,this.ws.txBytes+=r,null!=t?this.ws?.send(e,{binary:t}):this.ws?.send(e)}else console.log("not open")}bin(...e){}sendJSON(...e){let t=JSON.stringify(e);this.send(t)}iamResponse(){let e=[];for(let t of this.chMap.keys()){let r=this.chMap.get(t),n=[];r.forEach((e=>n.push(e)));let i={};i[t]=n,e.push(i)}let t={ssid:this.ssid,id:this.userID,nick:this.nick,ip:this.ip,chMap:e},r=j(Kn("#cmd","8",qe.IAM_RES),Kn("#info",t));this.send_enc_mode(r)}}process.on("uncaughtException",((e,t)=>{console.log("uncaughtException",e,t)}));class Xn{constructor(){this.privateChannelName=r().substring(0,18),this.publicIPChannelBaseName=r().substring(0,13),this.map=new Map,this.remocons=new Set,this.adminChannelIntervalID=null,this.adminMetricOption=0}addClient(e,t){this.remocons.add(new Jn(e,t,this))}removeClient(e){for(let t of e.chMap.keys())if(this.map.has(t)){const r=this.map.get(t);console.log(`channel [ ${t} ] removes client id: ${e.ssid} `),r.delete(e),this.checker()}this.remocons.delete(e)}broadcastTo(e,t,r,n){let i,s,o=0;if(e.includes("#")){let r=e.split("#");i=r[0]?r[0]:t.HOME_CHANNEL,s=r[1]?r[1]:"#"}else i=e,s="#";if(this.map.has(i)){let e=this.map.get(i);return e.size>=1&&e.forEach((e=>{if(e!==t&&e.chMap.has(i)){e.chMap.get(i).has(s)&&(e.send_enc_mode(r),o++)}})),["ok",o]}return console.log("no one subscribed"),["err","No one subscribed."]}broadcastToSubscribed(e,t,r,n){if(this.map.has(e)){let i=this.map.get(e);i.has(t)&&i.size>1&&i.forEach((e=>{e!==t&&e.send(r,n)}))}}addToPrivateChannel(e){let t=this.privateChannelName;return this.subscribe([t],e),this.checker(),t}addToGlobalIPChannel(e){let t=e.ip+this.publicIPChannelBaseName;return this.subscribe([t],e),this.checker(),t}subscribe(e,t){console.log("subscribe: ",e),e.forEach((e=>{let r,n;if(e.includes("#")){let i=e.split("#");r=i[0]?i[0]:t.HOME_CHANNEL,n=i[1]?i[1]:"#",console.log("chInfo",i)}else r=e,n="#";console.log("subscribe: ch,tag ",r,n),this.map.has(r)?this.map.get(r).add(t):this.map.set(r,new Set([t])),t.chMap.has(r)?t.chMap.get(r).add(n):t.chMap.set(r,new Set([n])),r===ht&&(t.isAdmin=!0,t.frame("admin","ok"))})),this.checker()}unsubscribe(e,t){let r,n,i=e[0];if(i.includes("#")){let e=i.split("#");r=e[0]?e[0]:t.HOME_CHANNEL,n=e[1]?e[1]:"#"}else r=i,n="#";console.log("unsub ch,tag",r,n);for(let e of t.chMap){let[r,i]=e;console.log("unsubscribe ",r,i),this.map.has(r)?(console.log("map has"),i.has(n)&&(console.log("match: ch && tagSet ",i),r===t.HOME_CHANNEL&&"#"===n?console.log("homechannel is immortal."):i.delete(n),0==i.size&&(console.log("no more ch tags. remove client from map."),this.map.get(r).delete(t),t.chMap.delete(r)))):console.log("map has not")}this.checker()}has(e){return this.map.has(e)}removeEmptyChannel(){const e=[];this.map.forEach(((t,r)=>{0===t.size&&e.push(r)})),e.length>=1&&e.forEach((e=>{this.map.delete(e)}))}adminCall(e,t=[]){if("t"===t[0]){this.adminChannelIntervalID&&clearInterval(this.adminChannelIntervalID);let e=t[1]>300?t[1]:1e3;this.adminChannelIntervalID=setInterval((e=>{this.adminChannelBroadCast()}),e)}else"c"===t[0]&&(this.adminMetricOption=t[1])}adminChannelBroadCast(){let e={};e.channels=this.getMetric(this.adminMetricOption),e.time=Date.now(),e.timeStamp=g();let t=["pub","admin",e];this.broadcastTo(ht,"",JSON.stringify(t))}getMetric(e=0){let t,r=[];if(0==e?t=this.remocons:1==e||(t=this.map.get(e)),1==e)this.map.forEach(((e,t)=>{let n=[];n=Array.from(e),n=n.map((e=>({ip:e.ip,ssid:e.ssid,nick:e.nick,uptime:Math.trunc((Date.now()-e.ws.openTime)/1e3),tx:e.ws.txCounter,rx:e.ws.rxCounter,txBytes:e.ws.txBytes,rxBytes:e.ws.rxBytes,echo:e.lastEchoMessage})));let i={name:t,clients:n};r.push(i)}));else{let n=[];if(!t)return[{name:"no channel",clients:[]}];n=Array.from(t),n=n.map((e=>({ip:e.ip,ssid:e.ssid,nick:e.nick,uptime:Math.trunc((Date.now()-e.ws.openTime)/1e3),tx:e.ws.txCounter,rx:e.ws.rxCounter,txBytes:e.ws.txBytes,rxBytes:e.ws.rxBytes,echo:e.lastEchoMessage})));let i={name:e,clients:n};r.push(i)}return r}checker(){const e=[];this.map.forEach(((t,r)=>{0===t.size&&e.push(r)})),e.length>=1&&e.forEach((e=>{this.map.delete(e)}))}keys(){return this.map.keys()}}class Zn{constructor(e){this.options=e,this.channelManager=new Xn,this.wss=new $n(e),this.wss.setMaxListeners(0);let t=parseInt(e.pingPeriod);this.pingPeriod=t>=1e3?t:5e4,this.wss.on("error",(e=>{console.error("### ws server error:",e)})),this.wss.on("close",(e=>{clearInterval(this.pingIntervalID),clearInterval(this.monitIntervalID)})),this.wss.on("connection",((e,t)=>{e.isAlive=!0,this.channelManager.addClient(e,t)})),this.pingIntervalID=setInterval((e=>{this.wss.clients.forEach((function(e){if(!1===e.isAlive)return console.log("terminate"),e.terminate();e.txCounter++,e.txBytes++,e.isAlive=!1,e.ping()}))}),this.pingPeriod),this.monitIntervalID=setInterval((e=>{}),5e3)}}yt.NodeWebSocket=dn;export{yt as Remocon,Zn as RemoconServer};
